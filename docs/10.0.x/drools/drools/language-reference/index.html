<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Rule Language Reference :: Drools Documentation</title>
    <link rel="canonical" href="https://docs.drools.org/latest/drools-docs/drools/language-reference/index.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<!--Licensed to the Apache Software Foundation (ASF) under one-->
<!--or more contributor license agreements.  See the NOTICE file-->
<!--distributed with this work for additional information-->
<!--regarding copyright ownership.  The ASF licenses this file-->
<!--to you under the Apache License, Version 2.0 (the-->
<!--"License"); you may not use this file except in compliance-->
<!--with the License.  You may obtain a copy of the License at-->

<!--http://www.apache.org/licenses/LICENSE-2.0-->

<!--Unless required by applicable law or agreed to in writing,-->
<!--software distributed under the License is distributed on an-->
<!--"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY-->
<!--KIND, either express or implied.  See the License for the-->
<!--specific language governing permissions and limitations-->
<!--under the License.-->

<link rel="stylesheet" href="../../_/css/search.css">
<link rel="stylesheet" href="../../_/css/menu.css">
<link rel="stylesheet" href="../../_/css/drl.css">
<!--Licensed to the Apache Software Foundation (ASF) under one-->
<!--or more contributor license agreements.  See the NOTICE file-->
<!--distributed with this work for additional information-->
<!--regarding copyright ownership.  The ASF licenses this file-->
<!--to you under the Apache License, Version 2.0 (the-->
<!--"License"); you may not use this file except in compliance-->
<!--with the License.  You may obtain a copy of the License at-->

<!--http://www.apache.org/licenses/LICENSE-2.0-->

<!--Unless required by applicable law or agreed to in writing,-->
<!--software distributed under the License is distributed on an-->
<!--"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY-->
<!--KIND, either express or implied.  See the License for the-->
<!--specific language governing permissions and limitations-->
<!--under the License.-->

<script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<!--Licensed to the Apache Software Foundation (ASF) under one-->
<!--or more contributor license agreements.  See the NOTICE file-->
<!--distributed with this work for additional information-->
<!--regarding copyright ownership.  The ASF licenses this file-->
<!--to you under the Apache License, Version 2.0 (the-->
<!--"License"); you may not use this file except in compliance-->
<!--with the License.  You may obtain a copy of the License at-->

<!--http://www.apache.org/licenses/LICENSE-2.0-->

<!--Unless required by applicable law or agreed to in writing,-->
<!--software distributed under the License is distributed on an-->
<!--"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY-->
<!--KIND, either express or implied.  See the License for the-->
<!--specific language governing permissions and limitations-->
<!--under the License.-->

<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://kie.apache.org/">
          <img src="../../_/img/droolsExpertLogo.png" alt="Drools logo"/>
        </a>
        <a class="navbar-item" href="https://kie.apache.org/">
          Drools Documentation
        </a>
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <a class="navbar-item small-item" href="https://github.com/apache/incubator-kie-drools" title="Follow Drools on GitHub"><div class="github-icon"></div></a>
          <a class="navbar-item small-item" href="https://twitter.com/KieCommunity" target="_blank" title="Follow KIE Community on Twitter for more Drools tweets"><img alt="T" src="../../_/img/twitterLogo.png"></a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="drools" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../introduction/index.html">Drools User Guide 10.0.0</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction/index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../KIE/index.html">Build, Deploy, Utilize and Run</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../rule-engine/index.html">Drools rule engine</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="index.html">Rule Language Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../language-reference-traditional/index.html">Rule Language Reference (Traditional)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../DMN/index.html">Decision Model and Notation (DMN)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../pragmatic-ai/index.html">Pragmatic AI: Integrating Machine Learning with Drools</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../Commands/index.html">Drools Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../migration-guide/index.html">Migration Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../experimental-features/index.html">Experimental features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../release-notes/index.html">Release Notes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Drools User Guide 10.0.0</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../introduction/index.html">Drools User Guide 10.0.0</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../introduction/index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../introduction/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../introduction/index.html">Drools User Guide 10.0.0</a></li>
    <li><a href="index.html">Rule Language Reference</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Rule Language Reference</h1>
<div class="sect1">
<h2 id="con-drl_drl-rules"><a class="anchor" href="#con-drl_drl-rules"></a>Drools Rule Language (DRL)</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Drools Rule Language (DRL) is a notation established by the <a href="https://www.drools.org/">Drools</a> open source business automation project for defining and describing business rules. You define DRL rules in <code>.drl</code> text files. A DRL file can contain one or more rules that define at a minimum the rule conditions (<code>when</code>) and actions (<code>then</code>).</p>
</div>
<div class="paragraph">
<p>DRL files consist of the following components:</p>
</div>
<div class="listingblock">
<div class="title">Components in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package
unit

import

declare   // Optional

query  // Optional

rule "rule name"
    // Attributes
    when
        // Conditions
    then
        // Actions
end

rule "rule2 name"

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example DRL rule determines the age limit in a loan application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example rule for loan application age limit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Underage"
  when
    /applicants[ applicantName : name, age &lt; 21 ]
    $application : /loanApplications[ applicant == applicantName ]
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
    update($application);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>A DRL file can contain single or multiple rules and queries, and can define resource declarations and attributes that are assigned and used by your rules and queries. The components in a DRL file are grouped in a defined rule unit that serves as a unique namespace for each group of rules. The DRL package followed by the rule unit definition must be listed at the top of a DRL file, and the rules are typically listed last. All other DRL components can follow any order.</p>
</div>
<div class="paragraph">
<p>Each rule must have a unique name within the rule unit. If you use the same rule name more than once in any DRL file in the unit, the rules fail to compile. Rule names generally must follow standard Java identifier conventions. However, you can enclose rule names with double quotation marks (<code>rule "rule name"</code>) to  prevent possible compilation errors, especially if you use spaces in rule names.</p>
</div>
<div class="sect2">
<h3 id="new-and-traditional-syntax_drl-rules"><a class="anchor" href="#new-and-traditional-syntax_drl-rules"></a>New and traditional syntax</h3>
<div class="paragraph">
<p>In Drools 10, we promote a new DRL syntax based on rule unit, data source, and OOPath. Hence, you will see such a new syntax in DRL syntax examples. However, Drools 10 still fully supports traditional DRL syntax that has been used in prior versions.</p>
</div>
<div class="listingblock">
<div class="title">Example rule for loan application with traditional syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Underage"
  when
    Applicant( applicantName : name, age &lt; 21 )
    $application : LoanApplication( applicant == applicantName )
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
    update($application);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the traditional syntax, please refer to <a href="#ref-con-drl_drl-rules-traditional">[ref-con-drl_drl-rules-traditional]</a></p>
</div>
</div>
<div class="sect2">
<h3 id="con-drl-packages_drl-rules"><a class="anchor" href="#con-drl-packages_drl-rules"></a>Packages in DRL</h3>
<div class="paragraph _abstract">
<p>A package is a folder of related assets in Drools, such as data objects, DRL files, decision tables, and other asset types. A package also serves as a unique namespace for each group of rules. A single rule base can contain multiple packages. You typically store all the rules for a package in the same file as the package declaration so that the package is self-contained. However, you can import objects from other packages that you want to use in the rules.</p>
</div>
<div class="paragraph">
<p>The following example is a package name and namespace for a DRL file in a mortgage application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example package definition in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following railroad diagram shows all the components that may make up a package:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/package.png" alt="package">
</div>
<div class="title">Figure 1. Package</div>
</div>
<div class="paragraph">
<p>Note that a package <em>must</em> have a namespace and be declared using standard Java conventions for package names; i.e., no spaces, unlike rule names which allow spaces.
In terms of the order of elements, they can appear in any order in the rule file, with the exception of the <code>package</code> and <code>unit</code> statements, which must be at the top of the file.
In all cases, the semicolons are optional.</p>
</div>
<div class="paragraph">
<p>Notice that any rule attribute (as described in the section <a href="#ref-rules-attributes_drl-rules">Rule attributes in DRL</a>) may also be written at package level, superseding the attribute&#8217;s default value.
The modified default may still be replaced by an attribute setting within a rule.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-drl-rule-units_drl-rules"><a class="anchor" href="#con-drl-rule-units_drl-rules"></a>Rule units in DRL</h3>
<div class="paragraph _abstract">
<p>Rule Unit API is explained in <a href="../KIE/index.html#rule-unit-api_packaging-deploying" class="xref page">Rule Unit API</a>. This section focuses on how to use rule units in DRL.</p>
</div>
<div class="paragraph">
<p>The following example is a rule unit designated in a DRL file in a mortgage application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example package definition and rule unit designation in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;
unit MortgageRules;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To define a rule unit, you need to write a Java class that implements <code>RuleUnitData</code> as written in <a href="../KIE/index.html#rule-unit-api_packaging-deploying" class="xref page">Rule Unit API</a>. Alternatively, you can declare the rule unit by implementing the <code>RuleUnitData</code> interface directly in DRL:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL rule unit file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;
unit MortgageRules;

import org.drools.ruleunits.api.RuleUnitData;
import org.drools.ruleunits.api.DataStream;

declare Person
    name : String
    dateOfBirth : Date
    address : Address
end

declare MortgageRules extends RuleUnitData
  persons: DataStream&lt;Person&gt;
end

rule "Using a rule unit with a declared type"
  when
    $p : /persons[ name == "James" ]
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    persons.append( mark );
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you declare a rule unit in DRL, the rule unit class will be generated by Drools at build time. It means that you can&#8217;t refer to the class in your client codes. Declared rule units are only useful when the client is also auto-generated, for example, REST endpoint generation by Drools-Quarkus integration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To separate the fact types from the rule unit for use with other DRL rules, you can declare the types in a separate DRL file and then use the DRL rule file to declare the data sources by using the <code>RuleUnitData</code> interface implementation:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL type declaration as a separate file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;

declare Person
    name : String
    dateOfBirth : Date
    address : Address
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example DRL rule unit file without explicitly defined types</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;
unit MortgageRules;

import org.drools.ruleunits.api.RuleUnitData;
import org.drools.ruleunits.api.DataStream;

declare MortgageRules extends RuleUnitData
  persons: DataStream&lt;Person&gt;
end

rule "Using a rule unit with a declared type"
  when
    $p : /persons[ name == "James" ]
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    persons.append( mark );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>persons</code> is a <code>DataStream</code> data source for facts of type <code>Person</code>. Data sources are typed sources of data that rule units can subscribe to for updates. You interact with the rule unit through the data sources it exposes. A data source can be a <code>DataStream</code> source for append-only storage, a <code>DataStore</code> source for writable storage to add or remove data, or a <code>SingletonStore</code> source for writable storage to set and clear a single element.</p>
</div>
<div class="paragraph">
<p>As part of your data source declaration, you also import <code>org.drools.ruleunits.api.RuleUnitData</code> and the relevant data source support, such as <code>import org.drools.ruleunits.api.DataStream</code> in this example.</p>
</div>
<div class="paragraph">
<p>You can add several rules to the same DRL file, or further break down the rule set and type declarations by creating more files. However you construct your rule sets, ensure that all DRL rule files exist in the same directory and start with the correct <code>package</code> and <code>unit</code> declarations.</p>
</div>
<div class="sect3">
<h4 id="_rule_unit_use_case"><a class="anchor" href="#_rule_unit_use_case"></a>Rule unit use case</h4>
<div class="paragraph">
<p>As an additional rule unit use case, consider the following example decision service that evaluates incoming data from a heat sensor for temperature measurements and produces alerts when the temperature is above a specified threshold.</p>
</div>
<div class="paragraph">
<p>This example service uses the following <code>types.drl</code> file in the <code>src/main/resources/org/acme</code> folder of the Drools project to declare the <code>Temperature</code> and the <code>Alert</code> fact types:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL type declarations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package com.acme;

declare Temperature
  value: double
end

declare Alert
    severity: String
    message: String
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>To define DRL rules that pattern-match against <code>Temperature</code> values, the example service must expose an entry point for the incoming data to the Drools rule engine and publish alerts on a separate channel. To establish this data source for decision data, the example service uses a rule unit with <code>DataStream</code> data sources for <code>Temperature</code> objects and for <code>Alert</code> objects.</p>
</div>
<div class="paragraph">
<p>The <code>DataStream</code> data source is an append-only store for incoming data, similar to a queue. This type of data source is logical for both sources in this example because the temperature data is coming from an external source (the sensor) and the service publishes the alerts externally as they are produced.</p>
</div>
<div class="paragraph">
<p>The example service uses the following <code>MonitoringService.drl</code> file in the same <code>src/main/resources/com/acme</code> folder of the Drools project to declare the data sources for the fact types and defines the rules for the rule unit:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL rule unit file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package com.acme;
unit MonitoringService;

import org.drools.ruleunits.api.RuleUnitData;
import org.drools.ruleunits.api.DataStream;

declare MonitoringService extends RuleUnitData
  temperatures: DataStream&lt;Temperature&gt;
  alertData: DataStream&lt;Alert&gt;
end

rule "tooHot"
when
    $temp : /temperatures[value &gt;= 80]
then
    alertData.append(new Alert("HIGH", "Temperature exceeds threshold: " + temp.value));
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule unit implements the required <code>RuleUnitData</code> interface and declares the data sources for the previously defined types. The sample rule raises an alert when the temperature reaches or exceeds 80 degrees.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-drl-imports_drl-rules"><a class="anchor" href="#con-drl-imports_drl-rules"></a>Import statements in DRL</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/import.png" alt="import">
</div>
<div class="title">Figure 2. Import</div>
</div>
<div class="paragraph _abstract">
<p>Similar to import statements in Java, imports in DRL files identify the fully qualified paths and type names for any objects that you want to use in the rules. You specify the package and data object in the format <code>packageName.objectName</code>, with multiple imports on separate lines. The Drools rule engine automatically imports classes from the Java package with the same name as the DRL package and from the package <code>java.lang</code>.</p>
</div>
<div class="paragraph">
<p>The following example is an import statement for a loan application object in a mortgage application decision service:</p>
</div>
<div class="listingblock">
<div class="title">Example import statement in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import org.mortgages.LoanApplication;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-drl-declarations_drl-rules"><a class="anchor" href="#con-drl-declarations_drl-rules"></a>Type declarations and metadata in DRL</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/type_declaration.png" alt="type declaration">
</div>
<div class="title">Figure 3. Type declaration</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/meta_data.png" alt="meta data">
</div>
<div class="title">Figure 4. Metadata</div>
</div>
<div class="paragraph _abstract">
<p>Declarations in DRL files define new fact types or metadata for fact types to be used by rules in the DRL file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>New fact types:</strong> The default fact type in the <code>java.lang</code> package of Drools is <code>Object</code>, but you can declare other types in DRL files as needed. Declaring fact types in DRL files enables you to define a new fact model directly in the Drools rule engine, without creating models in a lower-level language like Java. You can also declare a new type when a domain model is already built and you want to complement this model with additional entities that are used mainly during the reasoning process.</p>
</li>
<li>
<p><strong>Metadata for fact types:</strong> You can associate metadata in the format <code>@<em>KEY</em>( <em>VALUE</em> )</code> with new or existing facts. Metadata can be any kind of data that is not represented by the fact attributes and is consistent among all instances of that fact type. The metadata can be queried at run time by the Drools rule engine and used in the reasoning process.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="con-drl-declarations-without-metadata_drl-rules"><a class="anchor" href="#con-drl-declarations-without-metadata_drl-rules"></a>Type declarations without metadata in DRL</h4>
<div class="paragraph _abstract">
<p>A declaration of a new fact does not require any metadata, but must include a list of attributes or fields. If a type declaration does not include identifying attributes, the Drools rule engine searches for an existing fact class in the classpath and raises an error if the class is missing.</p>
</div>
<div class="paragraph">
<p>For example, the following DRL file contains a declaration of a new fact type <code>Person</code> from a <code>persons</code> data source and uses no metadata:</p>
</div>
<div class="listingblock">
<div class="title">Example declaration of a new fact type with a rule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare Person
  name : String
  dateOfBirth : java.util.Date
  address : Address
end

rule "Using a declared type"
  when
    $p : /persons[ name == "James" ]
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    persons.append( mark );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the new fact type <code>Person</code> has the three attributes <code>name</code>, <code>dateOfBirth</code>, and <code>address</code>. Each attribute has a type that can be any valid Java type, including another class that you create or a fact type that you previously declared. The <code>dateOfBirth</code> attribute has the type <code>java.util.Date</code>, from the Java API, and the <code>address</code> attribute has the previously defined fact type <code>Address</code>.</p>
</div>
<div class="paragraph">
<p>To avoid writing the fully qualified name of a class every time you declare it, you can define the full class name as part of the <code>import</code> clause:</p>
</div>
<div class="listingblock">
<div class="title">Example type declaration with the fully qualified class name in the import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import java.util.Date

declare Person
    name : String
    dateOfBirth : Date
    address : Address
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you declare a new fact type, the Drools rule engine generates at compile time a Java class representing the fact type. The generated Java class is a one-to-one JavaBeans mapping of the type definition.</p>
</div>
<div class="paragraph">
<p>For example, the following Java class is generated from the example <code>Person</code> type declaration:</p>
</div>
<div class="listingblock">
<div class="title">Generated Java class for the Person fact type declaration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Person implements Serializable {
    private String name;
    private java.util.Date dateOfBirth;
    private Address address;

    // Empty constructor
    public Person() {...}

    // Constructor with all fields
    public Person( String name, Date dateOfBirth, Address address ) {...}

    // If keys are defined, constructor with keys
    public Person( ...keys... ) {...}

    // Getters and setters
    // `equals` and `hashCode`
    // `toString`
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then use the generated class in your rules like any other fact, as illustrated in the previous rule example with the <code>Person</code> type declaration from a <code>persons</code> data source:</p>
</div>
<div class="listingblock">
<div class="title">Example rule that uses the declared Person fact type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Using a declared type"
  when
    $p : /persons[ name == "James" ]
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    persons.append( mark );
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-drl-declarations-enumerative_drl-rules"><a class="anchor" href="#con-drl-declarations-enumerative_drl-rules"></a>Enumerative type declarations in DRL</h4>
<div class="paragraph _abstract">
<p>DRL supports the declaration of enumerative types in the format <code>declare enum <em>FACT_TYPE</em></code>, followed by a comma-separated list of values ending with a semicolon. You can then use the enumerative list in the rules in the DRL file.</p>
</div>
<div class="paragraph">
<p>For example, the following enumerative type declaration defines days of the week for an employee scheduling rule:</p>
</div>
<div class="listingblock">
<div class="title">Example enumerative type declaration with a scheduling rule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare enum DaysOfWeek
   SUN("Sunday"),MON("Monday"),TUE("Tuesday"),WED("Wednesday"),THU("Thursday"),FRI("Friday"),SAT("Saturday");

   fullName : String
end

rule "Using a declared Enum"
  when
    $emp : /employees[ dayOff == DaysOfWeek.MON ]
  then
    ...
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-drl-declarations-extended_drl-rules"><a class="anchor" href="#con-drl-declarations-extended_drl-rules"></a>Extended type declarations in DRL</h4>
<div class="paragraph _abstract">
<p>DRL supports type declaration inheritance in the format <code>declare <em>FACT_TYPE_1</em> extends <em>FACT_TYPE_2</em></code>. To extend a type declared in Java by a subtype declared in DRL, you repeat the parent type in a declaration statement without any fields.</p>
</div>
<div class="paragraph">
<p>For example, the following type declarations extend a <code>Student</code> type from a top-level <code>Person</code> type, and a <code>LongTermStudent</code> type from the <code>Student</code> subtype:</p>
</div>
<div class="listingblock">
<div class="title">Example extended type declarations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import org.people.Person

declare Person end

declare Student extends Person
    school : String
end

declare LongTermStudent extends Student
    years : int
    course : String
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-drl-declarations-with-metadata_drl-rules"><a class="anchor" href="#con-drl-declarations-with-metadata_drl-rules"></a>Type declarations with metadata in DRL</h4>
<div class="paragraph _abstract">
<p>You can associate metadata in the format <code>@<em>KEY</em>( <em>VALUE</em> )</code> (the value is optional) with fact types or fact attributes. Metadata can be any kind of data that is not represented by the fact attributes and is consistent among all instances of that fact type. The metadata can be queried at run time by the Drools rule engine and used in the reasoning process. Any metadata that you declare before the attributes of a fact type are assigned to the fact type, while metadata that you declare after an attribute are assigned to that particular attribute.</p>
</div>
<div class="paragraph">
<p>In the following example, the two metadata attributes <code>@author</code> and <code>@dateOfCreation</code> are declared for the <code>Person</code> fact type, and the two metadata items <code>@key</code> (literal) and <code>@maxLength</code> are declared for the <code>name</code> attribute. The <code>@key</code> literal metadata attribute has no required value, so the parentheses and the value are omitted.</p>
</div>
<div class="listingblock">
<div class="title">Example metadata declaration for fact types and attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import java.util.Date

declare Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )

    name : String @key @maxLength( 30 )
    dateOfBirth : Date
    address : Address
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For declarations of metadata attributes for existing types, you can identify the fully qualified class name as part of the <code>import</code> clause for all declarations or as part of the individual <code>declare</code> clause:</p>
</div>
<div class="listingblock">
<div class="title">Example metadata declaration for an imported type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import org.drools.examples.Person

declare Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example metadata declaration for a declared type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare org.drools.examples.Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-drl-declarations-metadata-tags_drl-rules"><a class="anchor" href="#ref-drl-declarations-metadata-tags_drl-rules"></a>Metadata tags for fact type and attribute declarations in DRL</h4>
<div class="paragraph">
<p>Although you can define custom metadata attributes in DRL declarations, the Drools rule engine also supports the following predefined metadata tags for declarations of fact types or fact type attributes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The examples in this section that refer to the <code>VoiceCall</code> class assume that the sample application domain model includes the following class details:</p>
</div>
<div class="listingblock">
<div class="title">VoiceCall fact class in an example Telecom domain model</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class VoiceCall {
  private String  originNumber;
  private String  destinationNumber;
  private Date    callDateTime;
  private long    callDuration;  // in milliseconds

  // Constructors, getters, and setters
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@role</dt>
<dd>
<p>This tag determines whether a given fact type is handled as a regular fact or an event in the Drools rule engine during complex event processing.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: <code>fact</code></p>
</div>
<div class="paragraph">
<p>Supported parameters: <code>fact</code>, <code>event</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">@role( fact | event )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall as event type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare VoiceCall
  @role( event )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@timestamp</dt>
<dd>
<p>This tag is automatically assigned to every event in the Drools rule engine. By default, the time is provided by the session clock and assigned to the event when it is inserted into the working memory of the Drools rule engine. You can specify a custom time stamp attribute instead of the default time stamp added by the session clock.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: The time added by the Drools rule engine session clock</p>
</div>
<div class="paragraph">
<p>Supported parameters: Session clock time or custom time stamp attribute</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">@timestamp( <em>ATTRIBUTE_NAME</em> )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall timestamp attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@duration</dt>
<dd>
<p>This tag determines the duration time for events in the Drools rule engine. Events can be interval-based events or point-in-time events. Interval-based events have a duration time and persist in the working memory of the Drools rule engine until their duration time has lapsed. Point-in-time events have no duration and are essentially interval-based events with a duration of zero. By default, every event in the Drools rule engine has a duration of zero. You can specify a custom duration attribute instead of the default.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: Null (zero)</p>
</div>
<div class="paragraph">
<p>Supported parameters: Custom duration attribute</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">@duration( <em>ATTRIBUTE_NAME</em> )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall duration attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@expires</dt>
<dd>
<p>This tag determines the time duration before an event expires in the working memory of the Drools rule engine. By default, an event expires when the event can no longer match and activate any of the current rules. You can define an amount of time after which an event should expire. This tag definition also overrides the implicit expiration offset calculated from temporal constraints and sliding windows in the KIE base. This tag is available only when the Drools rule engine is running in stream mode.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: Null (event expires after event can no longer match and activate rules)</p>
</div>
<div class="paragraph">
<p>Supported parameters: Custom <code>timeOffset</code> attribute in the format <code>[#d][#h][#m][#s][#ms]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">@expires( <em>TIME_OFFSET</em> )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare expiration offset for VoiceCall events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
  @expires( 1h35m )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@typesafe</dt>
<dd>
<p>This tab determines whether a given fact type is compiled with or without type safety. By default, all type declarations are compiled with type safety enabled. You can override this behavior to type-unsafe evaluation, where all constraints are generated as MVEL constraints and executed dynamically. This is useful when dealing with collections that do not have any generics or mixed type collections.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: <code>true</code></p>
</div>
<div class="paragraph">
<p>Supported parameters: <code>true</code>, <code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">@typesafe( <em>BOOLEAN</em> )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare VoiceCall for type-unsafe evaluation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare VoiceCall
  @role( fact )
  @typesafe( false )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@serialVersionUID</dt>
<dd>
<p>This tag defines an identifying <code>serialVersionUID</code> value for a serializable class in a fact declaration. If a serializable class does not explicitly declare a <code>serialVersionUID</code>, the serialization run time calculates a default <code>serialVersionUID</code> value for that class based on various aspects of the class, as described in the <a href="https://docs.oracle.com/javase/10/docs/specs/serialization/index.html">Java Object Serialization Specification</a>. However, for optimal deserialization results and for greater compatibility with serialized KIE sessions, set the <code>serialVersionUID</code> as needed in the relevant class or in your DRL declarations.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: Null</p>
</div>
<div class="paragraph">
<p>Supported parameters: Custom <code>serialVersionUID</code> integer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">@serialVersionUID( <em>INTEGER</em> )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare serialVersionUID for a VoiceCall class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare VoiceCall
  @serialVersionUID( 42 )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@key</dt>
<dd>
<p>This tag enables a fact type attribute to be used as a key identifier for the fact type. The generated class can then implement the <code>equals()</code> and <code>hashCode()</code> methods to determine if two instances of the type are equal to each other. The Drools rule engine can also generate a constructor using all the key attributes as parameters.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Default parameter: None</p>
</div>
<div class="paragraph">
<p>Supported parameters: None</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><em>ATTRIBUTE_DEFINITION</em> @key</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Declare Person type attributes as keys</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare Person
    firstName : String @key
    lastName : String @key
    age : int
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example, the Drools rule engine checks the <code>firstName</code> and <code>lastName</code> attributes to determine if two instances of <code>Person</code> are equal to each other, but it does not check the <code>age</code> attribute. The Drools rule engine also implicitly generates three constructors: one without parameters, one with the <code>@key</code> fields, and one with all fields:</p>
</div>
<div class="listingblock">
<div class="title">Example constructors from the key declarations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Person() // Empty constructor

Person( String firstName, String lastName )

Person( String firstName, String lastName, int age )</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then create instances of the type based on the key constructors, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example instance using the key constructor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person person = new Person( "John", "Doe" );</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-drl-queries_drl-rules"><a class="anchor" href="#con-drl-queries_drl-rules"></a>Queries in DRL</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/query.png" alt="query">
</div>
<div class="title">Figure 5. Query</div>
</div>
<div class="paragraph _abstract">
<p>Queries in DRL files search the working memory of the Drools rule engine for facts related to the rules in the DRL file. You add the query definitions in DRL files and then obtain the matching results in your application code. Queries search for a set of defined conditions and do not require <code>when</code> or <code>then</code> specifications. Query names are scoped to the rule unit, so each query name must be unique within the same rule unit. In Drools, queries are automatically exposed as REST endpoints.</p>
</div>
<div class="paragraph">
<p>The following example is a query definition for an <code>Alert</code> object with a <code>severity</code> field set to <code>HIGH</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example query definition in a DRL file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package com.acme;
unit MonitoringService;

query highSeverity
    alerts : /alertData[ severity == "HIGH" ]
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools automatically exposes this query through an endpoint <code>/high-severity</code>.</p>
</div>
<div class="paragraph">
<p>For this example, assume that the <code>MonitoringService</code> rule unit class has the following form:</p>
</div>
<div class="listingblock">
<div class="title">Example Java rule unit class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.acme;

import org.drools.ruleunits.api.DataSource;
import org.drools.ruleunits.api.DataStream;

public class MonitoringService implements RuleUnitData {
    private DataStream&lt;Temperature&gt; temperature = DataSource.createStream();
    private DataStream&lt;Alert&gt; alertData = DataSource.createStream();
    public DataStream&lt;Temperature&gt; getTemperature() { return temperature; }
    public DataStream&lt;Alert&gt; getAlertData() { return alertData; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, you can invoke the query using the following command:</p>
</div>
<div class="listingblock">
<div class="title">Example POST request to the <code>/high-severity</code> endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ curl -X POST \
        -H 'Accept: application/json' \
        -H 'Content-Type: application/json' \
        -d '{ "eventData": [ { "type": "temperature", "value" : 20 }, { "type": "temperature", "value" : 100 } ] }' \
        http://localhost:8080/high-severity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "alerts" : [
        {
            "severity" : "HIGH",
            "message" : "Temperature exceeds threshold: 100"
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example submits the data to the <code>eventData</code> data source and returns the result of the <code>highSeverity</code> query as a response.</p>
</div>
</div>
<div class="sect2">
<h3 id="ref-rules-attributes_drl-rules"><a class="anchor" href="#ref-rules-attributes_drl-rules"></a>Rule attributes in DRL</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/rule_attributes.png" alt="rule attributes">
</div>
<div class="title">Figure 6. Rule attributes</div>
</div>
<div class="paragraph _abstract">
<p>Rule attributes are additional specifications that you can add to business rules to modify rule behavior.
In DRL files, you typically define rule attributes above the rule conditions and actions, with multiple attributes on separate lines, in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "rule_name"
    // Attribute
    // Attribute
    when
        // Conditions
    then
        // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table lists the names and supported values of the attributes that you can assign to rules:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Rule attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer defining the priority of the rule. Rules with a higher salience value are given higher priority when ordered in the internalMatch queue.</p>
<p class="tableblock">Example: <code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. When the option is selected, the rule is enabled. When the option is not selected, the rule is disabled.</p>
<p class="tableblock">Example: <code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing a date and time definition. The rule can be activated only if the current date and time is after a <code>date-effective</code> attribute.</p>
<p class="tableblock">Example: <code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing a date and time definition. The rule cannot be activated if the current date and time is after the <code>date-expires</code> attribute.</p>
<p class="tableblock">Example: <code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. When the option is selected, the rule cannot be reactivated (looped) if a consequence of the rule re-triggers a previously met condition. When the condition is not selected, the rule can be looped in these circumstances.</p>
<p class="tableblock">Example: <code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying an internalMatch (or XOR) group to which you want to assign the rule. In internalMatch groups, only one rule can be activated. The first rule to fire will cancel all pending internalMatches of all rules in the internalMatch group.</p>
<p class="tableblock">Example: <code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A long integer value defining the duration of time in milliseconds after which the rule can be activated, if the rule conditions are still met.</p>
<p class="tableblock">Example: <code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying either <code>int</code> (initialDelay interval) or <code>cron</code> timer definitions for scheduling the rule.</p>
<p class="tableblock">Example: <code>timer ( int: 30s 5m )</code>  (every 5 minutes after a 30-second delay)</p>
<p class="tableblock">         <code>timer ( cron:* 0/15 * * * ? )</code>  (every 15 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://www.quartz-scheduler.org/">Quartz</a> calendar definition for scheduling the rule.</p>
<p class="tableblock">Example: <code>calendars "* * 0-7,18-23 ? * *"</code>  (exclude non-business hours)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value, applicable only to rules within agenda groups. When the option is selected, the next time the rule is activated, a focus is automatically given to the agenda group to which the rule is assigned.</p>
<p class="tableblock">Example: <code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value, applicable only to rules within rule flow groups or agenda groups. When the option is selected, the next time the ruleflow group for the rule becomes active or the agenda group for the rule receives a focus, the rule cannot be activated again until the ruleflow group is no longer active or the agenda group loses the focus. This is a stronger version of the <code>no-loop</code> attribute, because the internalMatch of a matching rule is discarded regardless of the origin of the update (not only by the rule itself). This attribute is ideal for calculation rules where you have a number of rules that modify a fact and you do not want any rule re-matching and firing again.</p>
<p class="tableblock">Example: <code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying either <code>JAVA</code> or <code>MVEL</code> as the language to be used for code expressions in the rule. By default, the rule uses the dialect specified at the package level. Any dialect specified here overrides the package dialect setting for the rule.</p>
<p class="tableblock">Example: <code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="con-drl-timers-calendars_drl-rules"><a class="anchor" href="#con-drl-timers-calendars_drl-rules"></a>Timer and calendar rule attributes in DRL</h4>
<div class="paragraph _abstract">
<p>Timers and calendars are DRL rule attributes that enable you to apply scheduling and timing constraints to your DRL rules. These attributes require additional configurations depending on the use case.</p>
</div>
<div class="paragraph">
<p>The <code>timer</code> attribute in DRL rules is a string identifying either <code>int</code> (interval) or <code>cron</code> timer definitions for scheduling a rule and supports the following formats:</p>
</div>
<div class="listingblock">
<div class="title">Timer attribute formats</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">timer ( int: __INITIAL_DELAY__ __REPEAT_INTERVAL__ )

timer ( cron: __CRON_EXPRESSION__ )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example interval timer attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Run after a 30-second delay
timer ( int: 30s )

// Run every 5 minutes after a 30-second delay each time
timer ( int: 30s 5m )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example cron timer attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Run every 15 minutes
timer ( cron:* 0/15 * * * ? )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interval timers follow the semantics of <code>java.util.Timer</code> objects, with an initial delay and an optional repeat interval. Cron timers follow standard Unix cron expressions.</p>
</div>
<div class="paragraph">
<p>The following example DRL rule uses a cron timer to send an SMS text message every 15 minutes:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL rule with a cron timer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Send SMS message every 15 minutes"
  timer ( cron:* 0/15 * * * ? )
  when
    $a : Alarm( on == true )
  then
    channels[ "sms" ].insert( new Sms( $a.mobileNumber, "The alarm is still on." );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generally, a rule that is controlled by a timer becomes active when the rule is triggered and the rule consequence is executed repeatedly, according to the timer settings. The execution stops when the rule condition no longer matches incoming facts. However, the way the Drools rule engine handles rules with timers depends on whether the Drools rule engine is in <em>active mode</em> or in <em>passive mode</em>.</p>
</div>
<div class="paragraph">
<p>By default, the Drools rule engine runs in <em>passive mode</em> and evaluates rules, according to the defined timer settings, when a user or an application explicitly calls <code>fireAllRules()</code>. Conversely, if a user or application calls <code>fireUntilHalt()</code>, the Drools rule engine starts in <em>active mode</em> and evaluates rules continually until the user or application explicitly calls <code>halt()</code>.</p>
</div>
<div class="paragraph">
<p>When the Drools rule engine is in active mode, rule consequences are executed even after control returns from a call to <code>fireUntilHalt()</code> and the Drools rule engine remains <em>reactive</em> to any changes made to the working memory. For example, removing a fact that was involved in triggering the timer rule execution causes the repeated execution to terminate, and inserting a fact so that some rule matches causes that rule to be executed. However, the Drools rule engine is not continually <em>active</em>, but is active only after a rule is executed. Therefore, the Drools rule engine does not react to asynchronous fact insertions until the next execution of a timer-controlled rule. Disposing a KIE session terminates all timer activity.</p>
</div>
<div class="paragraph">
<p>When the Drools rule engine is in passive mode, rule consequences of timed rules are evaluated only when <code>fireAllRules()</code> is invoked again. However, you can change the default timer-execution behavior in passive mode by configuring the KIE session with a <code>TimedRuleExecutionOption</code> option, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">KIE session configuration to automatically execute timed rules in passive mode</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExecutionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can additionally set a <code>FILTERED</code> specification on the <code>TimedRuleExecutionOption</code> option that enables you to define a
callback to filter those rules, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">KIE session configuration to filter which timed rules are automatically executed</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( new TimedRuleExecutionOption.FILTERED(new TimedRuleExecutionFilter() {
    public boolean accept(Rule[] rules) {
        return rules[0].getName().equals("MyRule");
    }
}) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>For interval timers, you can also use an expression timer with <code>expr</code> instead of <code>int</code> to define both the delay and interval as an expression instead of a fixed value.</p>
</div>
<div class="paragraph">
<p>The following example DRL file declares a fact type with a delay and period that are then used in the subsequent rule with an expression timer:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with an expression timer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">declare Bean
  delay   : String = "30s"
  period  : long = 60000
end

rule "Expression timer"
  timer ( expr: $d, $p )
  when
    Bean( $d : delay, $p : period )
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expressions, such as <code>$d</code> and <code>$p</code> in this example, can use any variable defined in the pattern-matching part of the rule. The variable can be any <code>String</code> value that can be parsed into a time duration or any numeric value that is internally converted in a <code>long</code> value for a duration in milliseconds.</p>
</div>
<div class="paragraph">
<p>Both interval and expression timers can use the following optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>start</code> and <code>end</code>: A <code>Date</code> or a <code>String</code> representing a <code>Date</code> or a <code>long</code> value. The value can also be a <code>Number</code> that is transformed into a Java <code>Date</code> in the format <code>new Date( ((Number) n).longValue() )</code>.</p>
</li>
<li>
<p><code>repeat-limit</code>: An integer that defines the maximum number of repetitions allowed by the timer. If both the <code>end</code> and the <code>repeat-limit</code> parameters are set, the timer stops when the first of the two is reached.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example timer attribute with optional <code>start</code>, <code>end</code>, and <code>repeat-limit</code> parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer (int: 30s 1h; start=3-JAN-2020, end=4-JAN-2020, repeat-limit=50)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule is scheduled for every hour, after a delay of 30 seconds each hour, beginning on 3 January 2020 and ending either on 4 January 2020 or when the cycle repeats 50 times.</p>
</div>
<div class="paragraph">
<p>If the system is paused (for example, the session is serialized and then later deserialized), the rule is scheduled only one time to recover from missing internalMatches regardless of how many internalMatches were missed during the pause, and then the rule is subsequently scheduled again to continue in sync with the timer setting.</p>
</div>
<div class="paragraph">
<p>The <code>calendar</code> attribute in DRL rules is a <a href="http://www.quartz-scheduler.org/">Quartz</a> calendar definition for scheduling a rule and supports the following format:</p>
</div>
<div class="listingblock">
<div class="title">Calendar attribute format</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">calendars "<em>DEFINITION_OR_REGISTERED_NAME</em>"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example calendar attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Exclude non-business hours
calendars "* * 0-7,18-23 ? * *"

// Weekdays only, as registered in the KIE session
calendars "weekday"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can adapt a Quartz calendar based on the Quartz calendar API and then register the calendar in the KIE session, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Adapting a Quartz Calendar</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Calendar weekDayCal = QuartzHelper.quartzCalendarAdapter(org.quartz.Calendar quartzCal)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Registering the calendar in the KIE session</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getCalendars().set( "weekday", weekDayCal );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use calendars with standard rules and with rules that use timers. The calendar attribute can contain one or more comma-separated calendar names written as <code>String</code> literals.</p>
</div>
<div class="paragraph">
<p>The following example rules use both calendars and timers to schedule the rules:</p>
</div>
<div class="listingblock">
<div class="title">Example rules with calendars and timers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Weekdays are high priority"
  calendars "weekday"
  timer ( int:0 1h )
  when
    Alarm()
  then
    send( "priority high - we have an alarm" );
end

rule "Weekends are low priority"
  calendars "weekend"
  timer ( int:0 4h )
  when
    Alarm()
  then
    send( "priority low - we have an alarm" );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-drl-rules-conditions_drl-rules"><a class="anchor" href="#con-drl-rules-conditions_drl-rules"></a>Rule conditions in DRL</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/rule.png" alt="rule">
</div>
<div class="title">Figure 7. Rule</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/lhs.png" alt="lhs">
</div>
<div class="title">Figure 8. Conditional element in a rule</div>
</div>
<div class="paragraph _abstract">
<p>The <code>when</code> part of a DRL rule (also known as the <em>Left Hand Side (LHS)</em> of the rule) contains the conditions that must be met to execute an action. Conditions consist of a series of stated OOPath expressions of patterns and constraints, with optional bindings and supported rule condition elements (keywords), based on the available data objects in the package. OOPath is an object-oriented syntax extension to XPath for navigating through related elements while handling collections and filtering constraints.</p>
</div>
<div class="paragraph">
<p>For example, in a decision service that raises alerts when the temperature reaches or exceeds 80 degrees, a rule <code>tooHot</code> contains the <code>when</code> condition <code>/temperature[value &gt;= 80]</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
DRL uses <code>when</code> instead of <code>if</code> because <code>if</code> is typically part of a procedural execution flow during which a condition is checked at a specific point in time. In contrast, <code>when</code> indicates that the condition evaluation is not limited to a specific evaluation sequence or point in time, but instead occurs continually at any time. Whenever the condition is met, the actions are executed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the <code>when</code> section is empty, then the conditions are considered to be true and the actions in the <code>then</code> section are executed the first time the rules are fired. This is useful if you want to use rules to set up the Drools rule engine state.</p>
</div>
<div class="paragraph">
<p>The following example rule uses empty conditions to insert a fact every time the rule is executed:</p>
</div>
<div class="listingblock">
<div class="title">Example rule without conditions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "start-up"
  when
    // Empty
  then   // Actions to be executed once
    alerts.add( new Alert("INFO", "System started") );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Formally, the core grammar of an OOPath expression is defined in extended Backus-Naur form (EBNF) notation in the following way:</p>
</div>
<div class="listingblock">
<div class="title">EBNF notation for OOPath expressions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">OOPExpr = [ID ( ":" | ":=" )] ( "/" | "?/" ) OOPSegment { ( "/" | "?/" | "." ) OOPSegment } ;
OOPSegment = ID ["#" ID] ["[" ( Number | Constraints ) "]"]</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_oopath_expressions_and_constraints"><a class="anchor" href="#_oopath_expressions_and_constraints"></a>OOPath expressions and constraints</h4>
<div class="paragraph">
<p>An <em>OOPath expression</em> of a pattern in a DRL rule condition is the segment to be matched by the Drools rule engine. An OOPath expression can potentially match each fact that is inserted into the working memory of the Drools rule engine. It can also contain constraints to further define the facts to be matched.</p>
</div>
<div class="paragraph">
<p>In the simplest form, with no constraints, an OOPath expression matches a fact in the given data source. In the following example with a <code>DataSource&lt;Person&gt;</code> named <code>persons</code>, the expression matches against all <code>Person</code> objects in the data source of the Drools rule engine:</p>
</div>
<div class="listingblock">
<div class="title">Example expression for a single fact type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons</code></pre>
</div>
</div>
<div class="paragraph">
<p>Patterns can also refer to superclasses or even interfaces, potentially matching facts from many different classes. For example, the following pattern matches all <code>Student</code> subtypes of the <code>Person</code> object:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern for subtypes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons # Student</code></pre>
</div>
</div>
<div class="paragraph">
<p>Square brackets in a pattern enclose the constraints, such as the following constraint on the person&#8217;s age:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with a constraint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ age == 50 ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <em>constraint</em> is an expression that returns <code>true</code> or <code>false</code>. Constraints in DRL are essentially Java expressions with some enhancements, such as property access, and some differences, such as <code>equals()</code> and <code>!equals()</code> semantics for <code>==</code> and <code>!=</code> (instead of the usual <code>same</code> and <code>not same</code> semantics).</p>
</div>
<div class="paragraph">
<p>Any JavaBeans property can be accessed directly from pattern constraints. A JavaBeans property is exposed internally using a standard JavaBeans getter that takes no arguments and returns something. For example, the <code>age</code> property is written as <code>age</code> in DRL instead of the getter <code>getAge()</code>:</p>
</div>
<div class="listingblock">
<div class="title">DRL constraint syntax with JavaBeans properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ age == 50 ]

// This is equivalent to the following getter format:

/persons[ getAge() == 50 ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools uses the standard JDK <code>Introspector</code> class to achieve this mapping and follows the standard JavaBeans specification. For optimal Drools rule engine performance, use the property access format, such as <code>age</code>, instead of using getters explicitly, such as <code>getAge()</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use property accessors to change the state of the object in a way that might affect the rules because the Drools rule engine caches the results of the match between invocations for higher efficiency.</p>
</div>
<div class="paragraph">
<p>For example, do not use property accessors in the following ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public int getAge() {
    age++; // Do not do this.
    return age;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public int getAge() {
    Date now = DateUtil.now(); // Do not do this.
    return DateUtil.differenceInYears(now, birthday);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of following the second example, insert a fact that wraps the current date in the working memory and update that fact between rule executions as needed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, if the getter of a property cannot be found, the compiler uses the property name as a fallback method name, without arguments:</p>
</div>
<div class="listingblock">
<div class="title">Fallback method if object is not found</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ age == 50 ]

// If `Person.getAge()` does not exist, the compiler uses the following syntax:

/persons[ age() == 50 ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also nest access properties in patterns, as shown in the following example. Nested properties are indexed by the Drools rule engine.</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with nested property access</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ address.houseNumber == 50 ]

// This is equivalent to the following expression:

/persons[ getAddress().getHouseNumber() == 50 ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use any Java expression that returns a <code>boolean</code> value as a constraint inside the parentheses of a pattern. Java expressions can be mixed with other expression enhancements, such as property access:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with a constraint using property access and Java expression</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ age == 50 ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can change the evaluation priority by using parentheses, as in any logical or mathematical expression:</p>
</div>
<div class="listingblock">
<div class="title">Example evaluation order of constraints</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ age &gt; 100 &amp;&amp; ( age % 10 == 0 ) ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also reuse Java methods in constraints, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example constraints with reused Java methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ Math.round( weight / ( height * height ) ) &lt; 25.0 ]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use constraints to change the state of the object in a way that might affect the rules because the Drools rule engine caches the results of the match between invocations for higher efficiency. Any method that is executed on a fact in the rule conditions must be a read-only method. Also, the state of a fact should not change between rule invocations unless those facts are marked as updated in the working memory on every change.</p>
</div>
<div class="paragraph">
<p>For example, do not use a pattern constraint in the following ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ incrementAndGetAge() == 10 ] // Do not do this.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ System.currentTimeMillis() % 1000 == 0 ] // Do not do this.</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Standard Java operator precedence applies to constraint operators in DRL, and DRL operators follow standard Java semantics except for the <code>==</code> and <code>!=</code> operators.</p>
</div>
<div class="paragraph">
<p>The <code>==</code> operator uses null-safe <code>equals()</code> semantics instead of the usual <code>same</code> semantics. For example, the pattern <code>/persons[ firstName == "John" ]</code> is similar to <code>java.util.Objects.equals(person.getFirstName(), "John")</code>, and because <code>"John"</code> is not null, the pattern is also similar to <code>"John".equals(person.getFirstName())</code>.</p>
</div>
<div class="paragraph">
<p>The <code>!=</code> operator uses null-safe <code>!equals()</code> semantics instead of the usual <code>not same</code> semantics. For example, the pattern <code>/persons[ firstName != "John" ]</code> is similar to <code>!java.util.Objects.equals(person.getFirstName(), "John")</code>.</p>
</div>
<div class="paragraph">
<p>If the field and the value of a constraint are of different types, the Drools rule engine uses type coercion to resolve the conflict and reduce compilation errors. For instance, if <code>"ten"</code> is provided as a string in a numeric evaluator, a compilation error occurs, whereas <code>"10"</code> is coerced to a numeric 10. In coercion, the field type always takes precedence over the value type:</p>
</div>
<div class="listingblock">
<div class="title">Example constraint with a value that is coerced</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ age == "10" ] // "10" is coerced to 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>For groups of constraints, you can use a delimiting comma <code>,</code> to use implicit <code>and</code> connective semantics:</p>
</div>
<div class="listingblock">
<div class="title">Example patterns with multiple constraints</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Person is at least 50 years old and weighs at least 80 kilograms:
/persons[ age &gt; 50, weight &gt; 80 ]

// Person is at least 50 years old, weighs at least 80 kilograms, and is taller than 2 meters:
/persons[ age &gt; 50, weight &gt; 80, height &gt; 2 ]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although the <code>&amp;&amp;</code> and <code>,</code> operators have the same semantics, they are resolved with different priorities. The <code>&amp;&amp;</code> operator precedes the <code>||</code> operator, and both the <code>&amp;&amp;</code> and <code>||</code> operators together precede the <code>,</code> operator. Use the comma operator at the top-level constraint for optimal Drools rule engine performance and human readability.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You cannot embed a comma operator in a composite constraint expression, such as in parentheses:</p>
</div>
<div class="listingblock">
<div class="title">Example of misused comma in composite constraint expression</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Do not use the following format:
/persons[ ( age &gt; 50, weight &gt; 80 ) || height &gt; 2 ]

// Use the following format instead:
/persons[ ( age &gt; 50 &amp;&amp; weight &gt; 80 ) || height &gt; 2 ]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you write multiple OOPath lines</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">when
  /persons[ age == "10" ]
  /addresses[ city == "London" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before Drools 10, they were concatenated to one line <code>/persons[ age == "10" ]/addresses[ city == "London" ]</code>. To avoid that, you need to explicitly use a semicolon <code>;</code> to separate the OOPath lines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">when
  /persons[ age == "10" ];
  /addresses[ city == "London" ];</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Drools 10, Drools considers the new line as a separator between OOPath lines. So the semicolon is not required.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_bound_variables_in_patterns_and_constraints"><a class="anchor" href="#_bound_variables_in_patterns_and_constraints"></a>Bound variables in patterns and constraints</h4>
<div class="paragraph">
<p>You can bind variables to OOPath expressions of patterns and constraints to refer to matched objects in other portions of a rule. Bound variables can help you define rules more efficiently or more consistently with how you annotate facts in your data model.</p>
</div>
<div class="paragraph">
<p>For example, the following DRL rule uses the variable <code>$p</code> for an OOPath expression with the <code>Person</code> fact:</p>
</div>
<div class="listingblock">
<div class="title">Pattern with a bound variable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "simple rule"
  when
    $p : /persons
  then
    System.out.println( "Person " + p );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you can also bind variables to nested properties, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Two persons of the same age:
/persons[ firstAge : age ]  // Binding
and
/persons[ age == firstAge ] // Constraint expression</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you separate constraint bindings and constraint expressions for clearer and more efficient rule definitions. Although mixed bindings and expressions are supported, they can complicate patterns and affect evaluation efficiency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Do not use the following format:
/persons[ age : age * 2 &lt; 100 ]

// Use the following format instead:
/persons[ age * 2 &lt; 100, $age : age ]</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_nested_constraints_and_inline_casts"><a class="anchor" href="#_nested_constraints_and_inline_casts"></a>Nested constraints and inline casts</h4>
<div class="paragraph">
<p>In some cases, you might need to access multiple properties of a nested object, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern to access multiple properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ name == "mark", address.city == "london", address.country == "uk" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can group these property accessors to nested objects for more readable rules, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with grouped constraints</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ name == "mark"]/address[ city == "london", country == "uk" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you work with nested objects, you can use the syntax <code><em>TYPE</em>#<em>SUB_TYPE</em></code> to cast to a subtype and make the getters from the parent type available to the subtype. You can use either the object name or fully qualified class name, and you can cast to one or multiple subtypes, as shown in the following examples:</p>
</div>
<div class="listingblock">
<div class="title">Example patterns with inline casting to a subtype</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Inline casting with subtype name:
/persons[ name == "mark"]/address#LongAddress[ country == "uk" ]

// Inline casting with fully qualified class name:
/persons[ name == "mark"]/address#org.domain.LongAddress[ country == "uk" ]

// Multiple inline casts:
/persons[ name == "mark" ]/address#LongAddress/country#DetailedCountry[ population &gt; 10000000 ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>These example patterns cast <code>Address</code> to <code>LongAddress</code>, and additionally to <code>DetailedCountry</code> in the last example, making the parent getters available to the subtypes in each case.</p>
</div>
</div>
<div class="sect3">
<h4 id="_date_literal_in_constraints"><a class="anchor" href="#_date_literal_in_constraints"></a>Date literal in constraints</h4>
<div class="paragraph">
<p>By default, the Drools rule engine supports the date format <code>dd-mmm-yyyy</code>. You can customize the date format, including a time format mask if needed, by providing an alternative format mask with the system property <code>drools.dateformat="dd-mmm-yyyy hh:mm"</code>. You can also customize the date format by changing the language locale with the <code>drools.defaultlanguage</code> and <code>drools.defaultcountry</code> system properties. For example, the locale of Thailand is set as <code>drools.defaultlanguage=th</code> and <code>drools.defaultcountry=TH</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example pattern with a date literal restriction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ bornBefore &lt; "27-Oct-2009" ]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auto_boxing_and_primitive_types"><a class="anchor" href="#_auto_boxing_and_primitive_types"></a>Auto-boxing and primitive types</h4>
<div class="paragraph">
<p>Drools attempts to preserve numbers in their primitive or object wrapper form, so a variable bound to an int primitive when used in a code block or expression will no longer need manual unboxing; unlike early Drools versions where all primitives were autoboxed, requiring manual unboxing.
A variable bound to an object wrapper will remain as an object; the existing JDK 1.5 and JDK 5 rules to handle auto-boxing and unboxing apply in this case.
When evaluating field constraints, the system attempts to coerce one of the values into a comparable format; so a primitive is comparable to an object wrapper.</p>
</div>
</div>
<div class="sect3">
<h4 id="ref-drl-operators_drl-rules"><a class="anchor" href="#ref-drl-operators_drl-rules"></a>Supported operators in DRL constraints</h4>
<div class="paragraph _abstract">
<p>DRL supports standard Java semantics for operators in constraints, with some exceptions and with some additional operators that are unique in DRL. The following list summarizes the operators that are handled differently in DRL constraints than in standard Java semantics or that are unique in DRL constraints.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>/</code>, <code>#</code></dt>
<dd>
<p>Use the <code>/</code> operator to group property accessors to nested objects, and use the <code>#</code> operator to cast to a subtype in nested objects. Casting to a subtype makes the getters from the parent type available to the subtype. You can use either the object name or fully qualified class name, and you can cast to one or multiple subtypes.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with nested objects</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Ungrouped property accessors:
/persons[ name == "mark", address.city == "london", address.country == "uk" ]

// Grouped property accessors:
/persons[ name == "mark"]/address[ city == "london", country == "uk" ]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example constraints with inline casting to a subtype</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Inline casting with subtype name:
/persons[ name == "mark", address#LongAddress.country == "uk" ]

// Inline casting with fully qualified class name:
/persons[ name == "mark", address#org.domain.LongAddress.country == "uk" ]

// Multiple inline casts:
/persons[ name == "mark", address#LongAddress.country#DetailedCountry.population &gt; 10000000 ]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>!.</code></dt>
<dd>
<p>Use this operator to dereference a property in a null-safe way. The value to the left of the <code>!.</code> operator must be not null (interpreted as <code>!= null</code>) in order to give a positive result for pattern matching.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraint with null-safe dereferencing</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ $streetName : address!.street ]

// This is internally rewritten in the following way:

/persons[ address != null, $streetName : address.street ]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>[]</code></dt>
<dd>
<p>Use this operator to access a <code>List</code> value by index or a <code>Map</code> value by key.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>List</code> and <code>Map</code> access</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// The following format is the same as `childList(0).getAge() == 18`:
/persons[childList[0].age == 18]

// The following format is the same as `credentialMap.get("jdoe").isValid()`:
/persons[credentialMap["jdoe"].valid]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code></dt>
<dd>
<p>Use these operators on properties with natural ordering. For example, for <code>Date</code> fields, the <code>&lt;</code> operator means <em>before</em>, and for <code>String</code> fields, the operator means <em>alphabetically before</em>. These properties apply only to comparable properties.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>before</code> operator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ birthDate &lt; $otherBirthDate ]

/persons[ firstName &lt; $otherFirstName ]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>==</code>, <code>!=</code></dt>
<dd>
<p>Use these operators as <code>equals()</code> and <code>!equals()</code> methods in constraints, instead of the usual <code>same</code> and <code>not same</code> semantics.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraint with null-safe equality</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ firstName == "John" ]

// This is similar to the following formats:

java.util.Objects.equals(person.getFirstName(), "John")
"John".equals(person.getFirstName())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example constraint with null-safe not equality</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ firstName != "John" ]

// This is similar to the following format:

!java.util.Objects.equals(person.getFirstName(), "John")</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>&amp;&amp;</code>, <code>||</code></dt>
<dd>
<p>Use these operators to create an abbreviated combined relation condition that adds more than one restriction on a field. You can group constraints with parentheses <code>()</code> to create a recursive syntax pattern.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with abbreviated combined relation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Simple abbreviated combined relation condition using a single `&amp;&amp;`:
/persons[age &gt; 30 &amp;&amp; &lt; 40]

// Complex abbreviated combined relation using groupings:
/persons[age ((&gt; 30 &amp;&amp; &lt; 40) || (&gt; 20 &amp;&amp; &lt; 25))]

// Mixing abbreviated combined relation with constraint connectives:
/persons[age &gt; 30 &amp;&amp; &lt; 40 || location == "london"]</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/abbreviatedCombinedRelationCondition.png" alt="abbreviatedCombinedRelationCondition">
</div>
<div class="title">Figure 9. Abbreviated combined relation condition</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/abbreviatedCombinedRelationConditionGroup.png" alt="abbreviatedCombinedRelationConditionGroup">
</div>
<div class="title">Figure 10. Abbreviated combined relation condition withparentheses</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>matches</code>, <code>not matches</code></dt>
<dd>
<p>Use these operators to indicate that a field matches or does not match a specified Java regular expression. Typically, the regular expression is a <code>String</code> literal, but variables that resolve to a valid regular expression are also supported. These operators apply only to <code>String</code> properties. If you use <code>matches</code> against a <code>null</code> value, the resulting evaluation is always <code>false</code>. If you use <code>not matches</code> against a <code>null</code> value, the resulting evaluation is always <code>true</code>. As in Java, regular expressions that you write as <code>String</code> literals must use a double backslash <code>\\</code> to escape.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraint to match or not match a regular expression</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ country matches "(USA)?\\S*UK" ]

/persons[ country not matches "(USA)?\\S*UK" ]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>contains</code>, <code>not contains</code></dt>
<dd>
<p>Use these operators to verify whether a field that is an <code>Array</code> or a <code>Collection</code> contains or does not contain a specified value. These operators apply to <code>Array</code> or <code>Collection</code> properties, but you can also use these operators in place of <code>String.contains()</code> and <code>!String.contains()</code> constraints checks.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>contains</code> and <code>not contains</code> for a Collection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Collection with a specified field:
/familyTree[ countries contains "UK" ]

/familyTree[ countries not contains "UK" ]


// Collection with a variable:
/familyTree[ countries contains $var ]

/familyTree[ countries not contains $var ]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example constraints with <code>contains</code> and <code>not contains</code> for a String literal</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Sting literal with a specified field:
/persons[ fullName contains "Jr" ]

/persons[ fullName not contains "Jr" ]


// String literal with a variable:
/persons[ fullName contains $var ]

/persons[ fullName not contains $var ]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For backward compatibility, the <code>excludes</code> operator is a supported synonym for <code>not contains</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>memberOf</code>, <code>not memberOf</code></dt>
<dd>
<p>Use these operators to verify whether a field is a member of or is not a member of an <code>Array</code> or a <code>Collection</code> that is defined as a variable. The <code>Array</code> or <code>Collection</code> must be a variable.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>memberOf</code> and <code>not memberOf</code> with a Collection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/familyTree[ person memberOf $europeanDescendants ]

/familyTree[ person not memberOf $europeanDescendants ]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>soundslike</code></dt>
<dd>
<p>Use this operator to verify whether a word has almost the same sound, using English pronunciation, as the given value (similar to the <code>matches</code> operator). This operator uses the Soundex algorithm.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraint with <code>soundslike</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Match firstName "Jon" or "John":
/persons[ firstName soundslike "John" ]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>str</code></dt>
<dd>
<p>Use this operator to verify whether a field that is a <code>String</code> starts with or ends with a specified value. You can also use this operator to verify the length of the <code>String</code>.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example constraints with <code>str</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Verify what the String starts with:
/messages[ routingValue str[startsWith] "R1" ]

// Verify what the String ends with:
/messages[ routingValue str[endsWith] "R2" ]

// Verify the length of the String:
/messages[ routingValue str[length] 17 ]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>in</code>, <code>notin</code></dt>
<dd>
<p>Use these operators to specify more than one possible value to match in a constraint (compound value restriction). This functionality of compound value restriction is supported only in the <code>in</code> and <code>not in</code> operators. The second operand of these operators must be a comma-separated list of values enclosed in parentheses. You can provide values as variables, literals, return values, or qualified identifiers. These operators are internally rewritten as a list of multiple restrictions using the operators <code>==</code> or <code>!=</code>.</p>
<div class="openblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/compoundValueRestriction.png" alt="compoundValueRestriction">
</div>
<div class="title">Figure 11. compoundValueRestriction</div>
</div>
<div class="listingblock">
<div class="title">Example constraints with <code>in</code> and <code>notin</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/persons[ $color : favoriteColor ]
/colors[ type in ( "red", "blue", $color ) ]

/persons[ $color : favoriteColor ]
/colors[ type notin ( "red", "blue", $color ) ]</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-drl-operator-precedence_drl-rules"><a class="anchor" href="#ref-drl-operator-precedence_drl-rules"></a>Operator precedence in DRL pattern constraints</h4>
<div class="paragraph _abstract">
<p>DRL supports standard Java operator precedence for applicable constraint operators, with some exceptions and with some additional operators that are unique in DRL. The following table lists DRL operator precedence where applicable, from highest to lowest precedence:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Operator precedence in DRL pattern constraints</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator type</th>
<th class="tableblock halign-left valign-top">Operators</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nested or null-safe property access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code>, <code>!.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not standard Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List</code> or <code>Map</code> access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not standard Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constraint binding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not standard Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplicative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code>, <code>/%</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>, <code>-</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;</code>, <code>&gt;&gt;&gt;</code>, <code>&lt;&lt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>instanceof</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>== !=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <code>equals()</code> and <code>!equals()</code> semantics, not standard Java <code>same</code> and <code>not same</code> semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-short-circuiting <code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-short-circuiting exclusive <code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-short-circuiting inclusive <code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical <code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical <code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ternary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>? :</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated <code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>,</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not standard Java semantics</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ref-drl-rules-conditions-elements_drl-rules"><a class="anchor" href="#ref-drl-rules-conditions-elements_drl-rules"></a>Supported rule condition elements in DRL (keywords)</h4>
<div class="paragraph _abstract">
<p>DRL supports the following rule condition elements (keywords) that you can use with the patterns that you define in DRL rule conditions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>and</code></dt>
<dd>
<p>Use this to group conditional components into a logical conjunction. Infix and prefix <code>and</code> are supported. You can group patterns explicitly with parentheses <code>()</code>. By default, all listed patterns are combined with <code>and</code> when no conjunction is specified.</p>
<div class="openblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/infixAnd.png" alt="infixAnd">
</div>
<div class="title">Figure 12. infixAnd</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/prefixAnd.png" alt="prefixAnd">
</div>
<div class="title">Figure 13. prefixAnd</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>and</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">//Infix `and`:
colorType: /colors/type and /persons[ favoriteColor == colorType ]

//Infix `and` with grouping:
(colorType: /colors/type and (/persons[ favoriteColor == colorType ] or /persons[ favoriteColor == colorType ])

// Prefix `and`:
(and colorType: /colors/type /persons[ favoriteColor == colorType ])

// Default implicit `and`:
colorType: /colors/type
/persons[ favoriteColor == colorType ]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use a leading declaration binding with the <code>and</code> keyword (as you can with <code>or</code>, for example). A declaration can only reference a single fact at a time, and if you use a declaration binding with <code>and</code>, then when <code>and</code> is satisfied, it matches both facts and results in an error.</p>
</div>
<div class="listingblock">
<div class="title">Example misuse of <code>and</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Causes compile error:
$person : (/persons[ name == "Romeo" ] and /persons[ name == "Juliet"])</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>or</code></dt>
<dd>
<p>Use this to group conditional components into a logical disjunction. Infix and prefix <code>or</code> are supported. You can group patterns explicitly with parentheses <code>()</code>. You can also use pattern binding with <code>or</code>, but each pattern must be bound separately.</p>
<div class="openblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/infixOr.png" alt="infixOr">
</div>
<div class="title">Figure 14. infixOr</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/prefixOr.png" alt="prefixOr">
</div>
<div class="title">Figure 15. prefixOr</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>or</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">//Infix `or`:
colorType: /colors/type or /persons[ favoriteColor == colorType]

//Infix `or` with grouping:
colorType: /colors/type or (/persons[ favoriteColor == colorType] and /persons[ favoriteColor == colorType])

// Prefix `or`:
(or colorType: /colors/type /persons[ favoriteColor == colorType])</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>or</code> and pattern binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">pensioner : ( /persons[ sex == "f", age &gt; 60 ] or /persons[ sex == "m", age &gt; 65 ] )

(or pensioner : /persons[ sex == "f", age &gt; 60 ]
    pensioner : /persons[ sex == "m", age &gt; 65 ])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the <code>or</code> condition element is different from the connective <code>||</code> operator for constraints and restrictions in field constraints. The Drools rule engine does not directly interpret the <code>or</code> element but uses logical transformations to rewrite a rule with <code>or</code> as a number of sub-rules. This process ultimately results in a rule that has a single <code>or</code> as the root node and one sub-rule for each of its condition elements. Each sub-rule is activated and executed like any normal rule, with no special behavior or interaction between the sub-rules.</p>
</div>
<div class="paragraph">
<p>Therefore, consider the <code>or</code> condition element a shortcut for generating two or more similar rules that, in turn, can create multiple internalMatches when two or more terms of the disjunction are true.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>exists</code></dt>
<dd>
<p>Use this to specify facts and constraints that must exist. This option is triggered on only the first match, not subsequent matches. If you use this element with multiple patterns, enclose the patterns with parentheses <code>()</code>.</p>
<div class="openblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/exists.png" alt="exists">
</div>
<div class="title">Figure 16. Exists</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>exists</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">exists /persons[ firstName == "John"]

exists (/persons[ firstName == "John", age == 42 ])

exists (/persons[ firstName == "John" ] and
        /persons[ lastName == "Doe" ])</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>not</code></dt>
<dd>
<p>Use this to specify facts and constraints that must not exist. If you use this element with multiple patterns, enclose the patterns with parentheses <code>()</code>.</p>
<div class="openblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/not.png" alt="not">
</div>
<div class="title">Figure 17. Not</div>
</div>
<div class="listingblock">
<div class="title">Example patterns with <code>not</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">not /persons[ firstName == "John"]

not (/persons[ firstName == "John", age == 42 )]

not (/persons[ firstName == "John" ] and
     /persons[ lastName == "Doe" ])</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>forall</code></dt>
<dd>
<p>Use this to verify whether all facts that match the first pattern match all the remaining patterns. When a <code>forall</code> construct is satisfied, the rule evaluates to <code>true</code>. This element is a scope delimiter, so it can use any previously bound variable, but no variable bound inside of it is available for use outside of it.</p>
<div class="openblock">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/forall.png" alt="forall">
</div>
<div class="title">Figure 18. Forall</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>forall</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "All full-time employees have red ID badges"
  when
    forall( $emp : /employees[ type == "fulltime" ]
                   /employees[ this == $emp, badgeColor = "red" ] )
  then
    // True, all full-time employees have red ID badges.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule selects all <code>employee</code> objects whose type is <code>"fulltime"</code>. For each fact that matches this pattern, the rule evaluates the patterns that follow (badge color) and if they match, the rule evaluates to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>To state that all facts of a given type in the working memory of the Drools rule engine must match a set of constraints, you can use <code>forall</code> with a single pattern for simplicity.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>forall</code> and a single pattern</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "All full-time employees have red ID badges"
  when
    forall( /employees[ badgeColor = "red" ] )
  then
    // True, all full-time employees have red ID badges.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>forall</code> constructs with multiple patterns or nest them with other condition elements, such as inside a <code>not</code> element construct.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>forall</code> and multiple patterns</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "All employees have health and dental care programs"
  when
    forall( $emp : /employees
            /healthCare[ employee == $emp ]
            /dentalCare[ employee == $emp ]
          )
  then
    // True, all employees have health and dental care.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>forall</code> and <code>not</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Not all employees have health and dental care"
  when
    not ( forall( $emp : /employees
            /healthCare[ employee == $emp ]
            /dentalCare[ employee == $emp ] )
        )
  then
    // True, not all employees have health and dental care.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The format <code>forall( p1 p2 p3 &#8230;&#8203;)</code> is equivalent to <code>not( p1 and not( and p2 p3 &#8230;&#8203; ) )</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div id="accumulate" class="dlist">
<dl>
<dt class="hdlist1"><code>accumulate</code></dt>
<dd>
<p>Use this to iterate over a collection of objects, execute custom actions for each of the elements, and return one or more result objects (if the constraints evaluate to <code>true</code>). You can use predefined functions in your <code>accumulate</code> conditions or implement custom functions as needed. You can also use the abbreviation <code>acc</code> for <code>accumulate</code> in rule conditions.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use the following format to define <code>accumulate</code> conditions in rules:</p>
</div>
<div class="listingblock">
<div class="title">Preferred format for <code>accumulate</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">accumulate( <em>SOURCE_PATTERN</em>; <em>FUNCTIONS</em> [;<em>CONSTRAINTS</em>] )</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/accumulate.png" alt="accumulate">
</div>
<div class="title">Figure 19. Accumulate</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although the Drools rule engine supports alternate formats for the <code>accumulate</code> element for backward compatibility, this format is preferred for optimal performance in rules and applications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Drools rule engine supports the following predefined <code>accumulate</code> functions. These functions accept any expression as input.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>average</code></p>
</li>
<li>
<p><code>min</code></p>
</li>
<li>
<p><code>max</code></p>
</li>
<li>
<p><code>count</code></p>
</li>
<li>
<p><code>sum</code></p>
</li>
<li>
<p><code>collectList</code></p>
</li>
<li>
<p><code>collectSet</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example rule, <code>min</code>, <code>max</code>, and <code>average</code> are <code>accumulate</code> functions that calculate the minimum, maximum, and average temperature values over all the readings for each sensor:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>accumulate</code> to calculate temperature values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Raise alarm"
  when
    s : /sensors
    accumulate( /readings( sensor == $s, $temp : temperature );
                $min : min( $temp ),
                $max : max( $temp ),
                $avg : average( $temp );
                $min &lt; 20, $avg &gt; 70 )
  then
    // Raise the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example rule uses the <code>average</code> function with <code>accumulate</code> to calculate the average profit for all items in an order:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>accumulate</code> to calculate average profit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Average profit"
  when
    $order : /orders
    accumulate( /orderItems( order == $order, $cost : cost, $price : price );
                $avgProfit : average( 1 - $cost / $price ) )
  then
    // Average profit for `$order` is `$avgProfit`.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Built-in accumulate functions' return types may vary depend on parameter types. <code>min</code> and <code>max</code> can take <code>Comparable</code> parameters even if they are not numeric types, for example, <code>LocalDateTime</code>. In this case, the return type would be <code>Comparable</code>, so you may need to cast the bind variable of the return value in the rule.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use custom, domain-specific functions in <code>accumulate</code> conditions, create a Java class that implements the <code>org.kie.api.runtime.rule.AccumulateFunction</code> interface. For example, the following Java class defines a custom implementation of an <code>AverageData</code> function:</p>
</div>
<div class="listingblock">
<div class="title">Example Java class with custom implementation of <code>average</code> function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// An implementation of an accumulator capable of calculating average values

public class AverageAccumulateFunction implements org.kie.api.runtime.rule.AccumulateFunction&lt;AverageAccumulateFunction.AverageData&gt; {

    public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {

    }

    public void writeExternal(ObjectOutput out) throws IOException {

    }

    public static class AverageData implements Externalizable {
        public int    count = 0;
        public double total = 0;

        public AverageData() {}

        public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
            count   = in.readInt();
            total   = in.readDouble();
        }

        public void writeExternal(ObjectOutput out) throws IOException {
            out.writeInt(count);
            out.writeDouble(total);
        }

    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#createContext()
     */
    public AverageData createContext() {
        return new AverageData();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#init(java.io.Serializable)
     */
    public void init(AverageData context) {
        context.count = 0;
        context.total = 0;
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#accumulate(java.io.Serializable, java.lang.Object)
     */
    public void accumulate(AverageData context,
                           Object value) {
        context.count++;
        context.total += ((Number) value).doubleValue();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#reverse(java.io.Serializable, java.lang.Object)
     */
    public void reverse(AverageData context, Object value) {
        context.count--;
        context.total -= ((Number) value).doubleValue();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#getResult(java.io.Serializable)
     */
    public Object getResult(AverageData context) {
        return new Double( context.count == 0 ? 0 : context.total / context.count );
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#supportsReverse()
     */
    public boolean supportsReverse() {
        return true;
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#getResultType()
     */
    public Class&lt; ? &gt; getResultType() {
        return Number.class;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the custom function in a DRL rule, import the function using the <code>import accumulate</code> statement:</p>
</div>
<div class="listingblock">
<div class="title">Format to import a custom function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import accumulate <em>CLASS_NAME</em> <em>FUNCTION_NAME</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with the imported <code>average</code> function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import accumulate AverageAccumulateFunction.AverageData average

rule "Average profit"
  when
    $order : /orders
    accumulate( /orderItems[ order == $order, $cost : cost, $price : price ];
                $avgProfit : average( 1 - $cost / $price ) )
  then
    // Average profit for `$order` is `$avgProfit`.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For backward compatibility, the Drools rule engine also supports the configuration of <code>accumulate</code> functions through configuration files and system properties, but this is a deprecated method. To configure the <code>average</code> function from the previous example using the configuration file or system property, set a property as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">drools.accumulate.function.average = AverageAccumulateFunction.AverageData</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>drools.accumulate.function</code> is a required prefix, <code>average</code> is how the function is used in the DRL files, and <code>AverageAccumulateFunction.AverageData</code> is the fully qualified name of the class that implements the function behavior.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>groupby</code></dt>
<dd>
<p>Use this to partition a collection of objects into groups, and perform accumulate functions independently on each group. You can use predefined functions in your <code>groupby</code> conditions or implement custom functions as needed.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use the following format to define <code>groupby</code> conditions in rules:</p>
</div>
<div class="listingblock">
<div class="title">Preferred format for <code>groupby</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">groupby( <em>SOURCE_PATTERN</em>; <em>KEY_FUNCTION</em> ; <em>FUNCTIONS</em> [;<em>CONSTRAINTS</em>] )</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/groupby.png" alt="groupby">
</div>
<div class="title">Figure 20. Groupby</div>
</div>
<div class="paragraph">
<p>The Drools rule engine supports the same predefined <code>accumulate</code> functions that <a href="#accumulate">accumulate</a> allows. These functions accept any expression as input.</p>
</div>
<div class="paragraph">
<p>In the following example rule, <code>min</code>, <code>max</code>, and <code>average</code> are <code>accumulate</code> functions that calculate the minimum, maximum, and average temperature values over all the readings for each sensor by area:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>groupby</code> to calculate temperature values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Raise alarm"
  when
    s : /sensors
    groupby( /readings( sensor == $s, $temp : temperature, $area: area );
                $group: $area ;
                $min : min( $temp ),
                $max : max( $temp ),
                $avg : average( $temp );
                $min &lt; 20, $avg &gt; 70 )
  then
    // Raise the alarm for the group.
    $group.raiseAlarm();
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example rule uses the <code>average</code> function with <code>accumulate</code> to calculate the average profit for all items in an order:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>groupby</code> to calculate average profit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Average profit"
  when
    groupby( /orderItems( $order : order, $cost : cost, $price : price );
                $group: $order;
                $avgProfit : average( 1 - $cost / $price ) )
  then
    // Average profit for `$group` is `$avgProfit`.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Built-in accumulate functions' return types may vary depend on parameter types. <code>min</code> and <code>max</code> can take <code>Comparable</code> parameters even if they are not numeric types, for example, <code>LocalDateTime</code>. In this case, the return type would be <code>Comparable</code>, so you may need to cast the bind variable of the return value in the rule.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use custom, domain-specific functions in <code>groupby</code> conditions, follow the same procedure as <a href="#accumulate">accumulate</a>.</p>
</div>
<div class="paragraph">
<p>To use the custom function in a DRL rule, import the function using the <code>import accumulate</code> statement:</p>
</div>
<div class="listingblock">
<div class="title">Format to import a custom function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import accumulate <em>CLASS_NAME</em> <em>FUNCTION_NAME</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with the imported <code>average</code> function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import accumulate AverageAccumulateFunction.AverageData average

rule "Average profit"
  when
    groupby( /orderItems[ $order : order, $cost : cost, $price : price ];
                $group: $order;
                $avgProfit : average( 1 - $cost / $price ) )
  then
    // Average profit for `$group` is `$avgProfit`.
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-drl-rules-conditions-elements-diagrams_drl-rules"><a class="anchor" href="#ref-drl-rules-conditions-elements-diagrams_drl-rules"></a>Railroad diagrams for rule condition elements in DRL</h4>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AccumulateAction.png" alt="AccumulateAction">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AccumulateClause.png" alt="AccumulateClause">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AccumulateFunction.png" alt="AccumulateFunction">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AccumulateInit.png" alt="AccumulateInit">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AccumulateResult.png" alt="AccumulateResult">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AccumulateReverse.png" alt="AccumulateReverse">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AccumulateSteps.png" alt="AccumulateSteps">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Accumulations.png" alt="Accumulations">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AdditiveExpr.png" alt="AdditiveExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Annotation.png" alt="Annotation">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Arguments.png" alt="Arguments">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ArrayCreatorRest.png" alt="ArrayCreatorRest">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ArrayInitializer.png" alt="ArrayInitializer">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/AssignmentOperator.png" alt="AssignmentOperator">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/BindingPattern.png" alt="BindingPattern">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Block.png" alt="Block">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/BooleanLiteral.png" alt="BooleanLiteral">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/CompilationUnit.png" alt="CompilationUnit">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalAnd.png" alt="ConditionalAnd">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalElementAccumulate.png" alt="ConditionalElementAccumulate">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalElementEval.png" alt="ConditionalElementEval">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalElementExists.png" alt="ConditionalElementExists">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalElementForall.png" alt="ConditionalElementForall">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalElementNot.png" alt="ConditionalElementNot">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalElement.png" alt="ConditionalElement">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalExpr.png" alt="ConditionalExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalOrExpr.png" alt="ConditionalOrExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ConditionalOr.png" alt="ConditionalOr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Constraints.png" alt="Constraints">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/CreatedName.png" alt="CreatedName">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Creator.png" alt="Creator">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Definition.png" alt="Definition">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Digit.png" alt="Digit">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ExplicitGenericInvocationSuffix.png" alt="ExplicitGenericInvocationSuffix">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ExplicitGenericInvocation.png" alt="ExplicitGenericInvocation">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Exponent.png" alt="Exponent">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ExpressionList.png" alt="ExpressionList">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Expression.png" alt="Expression">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Field.png" alt="Field">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Fraction.png" alt="Fraction">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/FromAccumulateClause.png" alt="FromAccumulateClause">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/FromClause.png" alt="FromClause">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/FromCollectClause.png" alt="FromCollectClause">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/FunctionDefinition.png" alt="FunctionDefinition">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/GlobalDefinition.png" alt="GlobalDefinition">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/IdentifierSuffix.png" alt="IdentifierSuffix">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ImportDefinition.png" alt="ImportDefinition">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/InExpr.png" alt="InExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/InlineListExpr.png" alt="InlineListExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/InlineMapExpr.png" alt="InlineMapExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/InnerCreator.png" alt="InnerCreator">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/InstanceOfExpr.png" alt="InstanceOfExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/IntLiteral.png" alt="IntLiteral">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Literal.png" alt="Literal">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ModifyStatement.png" alt="ModifyStatement">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/NonWildcardTypeArguments.png" alt="NonWildcardTypeArguments">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/OrRestriction.png" alt="OrRestriction">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/OverClause.png" alt="OverClause">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Parameters.png" alt="Parameters">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Pattern.png" alt="Pattern">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Placeholders.png" alt="Placeholders">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Primary.png" alt="Primary">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/PrimitiveType.png" alt="PrimitiveType">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/QualifiedName.png" alt="QualifiedName">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/QueryDefinition.png" alt="QueryDefinition">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/QueryOptions.png" alt="QueryOptions">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RealLiteral.png" alt="RealLiteral">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RealTypeSuffix.png" alt="RealTypeSuffix">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RelationalExpr.png" alt="RelationalExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RelationalOperator.png" alt="RelationalOperator">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RhsStatement.png" alt="RhsStatement">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RuleAttributes.png" alt="RuleAttributes">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RuleAttribute.png" alt="RuleAttribute">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RuleDefinition.png" alt="RuleDefinition">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/RuleOptions.png" alt="RuleOptions">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Selector.png" alt="Selector">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ShiftExpr.png" alt="ShiftExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/SingleRestriction.png" alt="SingleRestriction">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/SourcePattern.png" alt="SourcePattern">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/StringId.png" alt="StringId">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/SuperSuffix.png" alt="SuperSuffix">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/ThenPart.png" alt="ThenPart">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/TypeArguments.png" alt="TypeArguments">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/TypeArgument.png" alt="TypeArgument">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/TypeDefinition.png" alt="TypeDefinition">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/TypeOptions.png" alt="TypeOptions">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Type.png" alt="Type">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/UnaryExprNotPlusMinus.png" alt="UnaryExprNotPlusMinus">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/UnaryExpr.png" alt="UnaryExpr">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Value.png" alt="Value">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/VariableInitializer.png" alt="VariableInitializer">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/WhenPart.png" alt="WhenPart">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-drl-rules-actions_drl-rules"><a class="anchor" href="#con-drl-rules-actions_drl-rules"></a>Rule actions in DRL</h3>
<div class="paragraph _abstract">
<p>The <code>then</code> part of the rule (also known as the <em>Right Hand Side (RHS)</em> of the rule) contains the actions to be performed when the conditional part of the rule has been met. Rule actions are typically determined by one or more <em>data sources</em> that you define as part of your DRL rule unit. For example, if a bank requires loan applicants to have over 21 years of age (with a rule condition <code>/applicants[ applicantName : name, age &lt; 21 ]</code>) and a loan applicant is under 21 years old, the <code>then</code> action of an <code>"Underage"</code> rule would be <code>setApproved( false )</code> based on a defined data source, declining the loan because the applicant is under age.</p>
</div>
<div class="paragraph">
<p>The main purpose of rule actions is to to insert, delete, or modify data in the working memory of the Drools rule engine. Effective rule actions are small, declarative, and readable. If you need to use imperative or conditional code in rule actions, then divide the rule into multiple smaller and more declarative rules.</p>
</div>
<div class="listingblock">
<div class="title">Example rule for loan application age limit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Underage"
  when
    /applicants[ applicantName : name, age &lt; 21 ]
    $application : /loanApplications[ applicant == applicantName ]
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about using data sources for rule actions, see <a href="#con-drl-rule-units_drl-rules">Rule units in DRL</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drl-rules-THEN-methods-ref_drl-rules"><a class="anchor" href="#drl-rules-THEN-methods-ref_drl-rules"></a>Supported rule action methods in DRL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DRL supports the following rule action methods that you can use in DRL rule actions. You can use these methods to modify the working memory of the Drools rule engine without having to first reference a working memory instance.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>modify</code></dt>
<dd>
<p>Use this to specify fields to be modified for a fact and to notify the Drools rule engine of the change. This method provides a structured approach to fact updates. It combines the <code>update</code> operation with setter calls to change object fields.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">modify ( &lt;fact-expression&gt; ) {
    &lt;expression&gt;,
    &lt;expression&gt;,
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to modify a loan application amount and approval</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">modify( $application ) {
        setAmount( 100 ),
        setApproved ( true )
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>update</code></dt>
<dd>
<p>Use this to specify fields and the entire related fact to be updated and to notify the Drools rule engine of the change. After a fact has changed, you must call <code>update</code> before changing another fact that might be affected by the updated values. To avoid this added step, use the <code>modify</code> method instead.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">update ( &lt;object, &lt;handle&gt; )  // Informs the Drools rule engine that an object has changed

update ( &lt;object&gt; )  // Causes `KieSession` to search for a fact handle of the object</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to update a loan application amount and approval</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$application.setAmount( 100 );
update( $application );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When <code>modify</code> or <code>update</code> is called in a rule, its actual evaluation happens after executing the whole RHS code. It means all modifications in the RHS will affect in the evaluation. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$application.setAmount( 100 );
update( $application );
$application.setApproved( true );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The modifications of both <code>amount</code> and <code>approved</code> are considered in the evaluation of the update.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you provide property-change listeners, you do not need to call this method when an object changes. For more information about property-change listeners, see
<a href="../rule-engine/index.html#property-change-listeners-con_rule-engine" class="xref page">Property-change settings and listeners for fact types</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>insert</code></dt>
<dd>
<p>Use this to insert a <code>new</code> fact into the working memory of the Drools rule engine and to define resulting fields and values as needed for the fact.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">insert( new &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to insert a new loan applicant object</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">insert( new Applicant() );</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>insert</code> and <code>insertLogical</code> insert a fact into "DEFAULT" entry-point. In Rule Unit use cases, you must specify a DataSource where you want to insert the fact. Hence, you must call <code>DataStore.add</code> instead of <code>insert</code> and <code>DataStore.addLogical</code> instead of <code>insertLogical</code>.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>insertLogical</code></dt>
<dd>
<p>Use this to insert a <code>new</code> fact logically into the Drools rule engine. The Drools rule engine is responsible for logical decisions on insertions and retractions of facts. After regular or stated insertions, facts must be retracted explicitly. After logical insertions, the facts that were inserted are automatically retracted when the conditions in the rules that inserted the facts are no longer true.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">insertLogical( new &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to logically insert a new loan applicant object</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">insertLogical( new Applicant() );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>delete</code></dt>
<dd>
<p>Use this to remove an object from the Drools rule engine. The keyword <code>retract</code> is also supported in DRL and executes the same action, but <code>delete</code> is typically preferred in DRL code for consistency with the keyword <code>insert</code>.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">delete( &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule action to delete a loan applicant object</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">delete( Applicant );</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drl-rules-THEN-methods-variables-ref_drl-rules"><a class="anchor" href="#drl-rules-THEN-methods-variables-ref_drl-rules"></a>Other rule action methods from <code>drools</code> variable</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the standard rule action methods, the Drools rule engine supports methods in conjunction with the predefined <code>drools</code> variable that you can also use in rule actions.</p>
</div>
<div class="paragraph">
<p>You can use the <code>drools</code> variable to call methods from the <code>org.kie.api.runtime.rule.RuleContext</code> class in your Drools distribution, which is also the class that the standard rule action methods are based on. For all <code>drools</code> rule action options,</p>
</div>
<div class="paragraph">
<p>see the Drools <a href="https://github.com/apache/incubator-kie-drools/blob/main/kie-api/src/main/java/org/kie/api/runtime/rule/RuleContext.java">RuleContext.java</a> page in GitHub.</p>
</div>
<div class="paragraph">
<p>The <code>drools</code> variable contains methods that provide information about the firing rule and the set of facts that activated the firing rule:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.getRule().getName()</code>: Returns the name of the currently firing rule.</p>
</li>
<li>
<p><code>drools.getMatch()</code>: Returns the <code>Match</code> that activated the currently firing rule. It contains information that is useful for logging and debugging purposes, for instance <code>drools.getMatch().getObjects()</code> returns the list of objects, enabling rule to fire in the proper tuple order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From the <code>drools</code> variable, you can also obtain a reference to the <code>KieRuntime</code> providing useful methods to interact with the running session, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.getKieRuntime().halt()</code>: Terminates rule execution if a user or application previously called <code>fireUntilHalt()</code>. When a user or application calls <code>fireUntilHalt()</code> method, the Drools rule engine starts in <code>active</code> mode and evaluates rules until the user or application explicitly calls <code>halt()</code> method. Otherwise, by default, the Drools rule engine runs in <code>passive</code> mode and evaluates rules only when a user or an application explicitly calls <code>fireAllRules()</code> method.</p>
</li>
<li>
<p><code>drools.getKieRuntime().getAgenda()</code>: Returns a reference to the KIE session <code>Agenda</code>, and in turn provides access to rule internalMatch groups, rule agenda groups, and ruleflow groups.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example call to access agenda group "CleanUp" and set the focus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">drools.getKieRuntime().getAgenda().getAgendaGroup( "CleanUp" ).setFocus();</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
This example sets the focus to a specified agenda group to which the rule belongs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.getKieRuntime().setGlobal()</code>, <code>~.getGlobal()</code>, <code>~.getGlobals()</code>: Sets or retrieves global variables.</p>
</li>
<li>
<p><code>drools.getKieRuntime().getEnvironment()</code>: Returns the runtime <code>Environment</code>, similar to your operating system environment.</p>
</li>
<li>
<p><code>drools.getKieRuntime().getQueryResults(&lt;string&gt; query)</code>: Runs a query and returns the results.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you use rule units, <code>drools.getKieRuntime()</code> is not available, because rule units use lightweight sessions.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="con-drl-rules-comments_drl-rules"><a class="anchor" href="#con-drl-rules-comments_drl-rules"></a>Comments in DRL files</h3>
<div class="paragraph _abstract">
<p>DRL supports single-line comments prefixed with a double forward slash <code>//</code> and multi-line comments enclosed with a forward slash and asterisk <code>/* &#8230;&#8203; */</code>. You can use DRL comments to annotate rules or any related components in DRL files. DRL comments are ignored by the Drools rule engine when the DRL file is processed.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with comments</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Underage"
  // This is a single-line comment.
  when
    /applicants[ applicantName : name, age &lt; 21 ]  // This is an in-line comment
    $application : /loanApplications[ applicant == applicantName ]
  then
    /* This is a multi-line comment
    in the rule actions. */
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/multi_line_comment.png" alt="multi line comment">
</div>
<div class="title">Figure 21. Multi-line comment</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The hash symbol <code>#</code> is not supported for DRL comments.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ref-drl-rules-errors_drl-rules"><a class="anchor" href="#ref-drl-rules-errors_drl-rules"></a>Error messages for DRL troubleshooting</h3>
<div class="paragraph _abstract">
<p>Drools provides standardized messages for DRL errors to help you troubleshoot and resolve problems in your DRL files. The error messages use the following format:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/error_message.png" alt="error message">
</div>
<div class="title">Figure 22. Error message format for DRL file problems</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>1st Block:</strong> Error code</p>
</li>
<li>
<p><strong>2nd Block:</strong> Line and column in the DRL source where the error occurred</p>
</li>
<li>
<p><strong>3rd Block:</strong> Description of the problem</p>
</li>
<li>
<p><strong>4th Block:</strong> Component in the DRL source (rule, function, query) where the error occurred</p>
</li>
<li>
<p><strong>5th Block:</strong> Pattern in the DRL source where the error occurred (if applicable)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools supports the following standardized error messages:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">101: no viable alternative</dt>
<dd>
<p>Indicates that the parser reached a decision point but could not identify an alternative.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with incorrect spelling</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1: rule "simple rule"
2:   when
3:     exists /persons
4:     exits /students  // Must be `exists`
5:   then
6: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ERR 101] Line 4:4 no viable alternative at input 'exits' in rule "simple rule"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule without a rule name</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1: package org.drools.examples;
2: rule    // Must be `rule "rule name"` (or `rule rule_name` if no spacing)
3:   when
4:     Object()
5:   then
6:     System.out.println("A RHS");
7: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ERR 101] Line 3:2 no viable alternative at input 'when'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the parser encountered the keyword <code>when</code> but expected the rule name, so it flags <code>when</code> as the incorrect expected token.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with incorrect syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1: rule "simple rule"
2:   when
3:     /students[ name == "Andy ]  // Must be `"Andy"`
4:   then
5: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ERR 101] Line 0:-1 no viable alternative at input '&lt;eof&gt;' in rule "simple rule" in pattern student</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A line and column value of <code>0:-1</code> means the parser reached the end of the source file (<code>&lt;eof&gt;</code>) but encountered incomplete constructs, usually due to missing quotation marks <code>"&#8230;&#8203;"</code>, apostrophes <code>'&#8230;&#8203;'</code>, or parentheses <code>(&#8230;&#8203;)</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">102: mismatched input</dt>
<dd>
<p>Indicates that the parser expected a particular symbol that is missing at the current input position.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with an incomplete rule statement</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1: rule "simple rule"
2:   when
3:     $p : /persons[
        // Must be a complete rule statement</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ERR 102] Line 0:-1 mismatched input '&lt;eof&gt;' expecting ']' in rule "simple rule" in pattern person</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A line and column value of <code>0:-1</code> means the parser reached the end of the source file (<code>&lt;eof&gt;</code>) but encountered incomplete constructs, usually due to missing quotation marks <code>"&#8230;&#8203;"</code>, apostrophes <code>'&#8230;&#8203;'</code>, or parentheses <code>(&#8230;&#8203;)</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example rule with incorrect syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1: package org.drools.examples;
2:
3: rule "Wrong syntax"
4:   when
5:     not /cars[ ( type == "tesla", price == 10000 ) || ( type == "kia", price == 1000 ) ]
       // Must use `&amp;&amp;` operators instead of commas `,`
6:   then
7:     System.out.println("OK");
8: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error messages</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ERR 102] Line 5:36 mismatched input ',' expecting ')' in rule "Wrong syntax" in pattern car
[ERR 101] Line 5:57 no viable alternative at input 'type' in rule "Wrong syntax"
[ERR 102] Line 5:106 mismatched input ']' expecting 'then' in rule "Wrong syntax"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the syntactic problem results in multiple error messages related to each other. The single solution of replacing the commas <code>,</code> with <code>&amp;&amp;</code> operators resolves all errors. If you encounter multiple errors, resolve one at a time in case errors are consequences of previous errors.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">103: failed predicate</dt>
<dd>
<p>Indicates that a validating semantic predicate evaluated to <code>false</code>. These semantic predicates are typically used to identify component keywords in DRL files, such as <code>declare</code>, <code>rule</code>, <code>exists</code>, <code>not</code>, and others.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with an invalid keyword</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"> 1: package nesting;
 2:
 3: import org.drools.compiler.Person
 4: import org.drools.compiler.Address
 5:
 6: Some text  // Must be a valid DRL keyword
 7:
 8: rule "test something"
 9:   when
10:     $p: /persons[ name=="Michael" ]
11:   then
12:     $p.name = "other";
13:     System.out.println(p.name);
14: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ERR 103] Line 6:0 rule 'rule_key' failed predicate: {(validateIdentifierKey(DroolsSoftKeywords.RULE))}? in rule</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Some text</code> line is invalid because it does not begin with or is not a part of a DRL keyword construct, so the parser fails to validate the rest of the DRL file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This error is similar to <code>102: mismatched input</code>, but usually involves DRL keywords.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">105: did not match anything</dt>
<dd>
<p>Indicates that the parser reached a sub-rule in the grammar that must match an alternative at least once, but the sub-rule did not match anything. The parser has entered a branch with no way out.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example rule with invalid text in an empty condition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1: rule "empty condition"
2:   when
3:     None  // Must remove `None` if condition is empty
4:   then
5:      insert( new Person() );
6: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ERR 105] Line 2:2 required (...)+ loop did not match anything at input 'WHEN' in rule "empty condition"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the condition is intended to be empty but the word <code>None</code> is used. This error is resolved by removing <code>None</code>, which is not a valid DRL keyword, data type, or pattern construct.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="con-drl-legacy_drl-rules"><a class="anchor" href="#con-drl-legacy_drl-rules"></a>Legacy DRL conventions</h3>
<div class="paragraph _abstract">
<p>The following Drools Rule Language (DRL) conventions are no longer applicable or optimal in Drools but might be available for backward compatibility.</p>
</div>
<div class="sect3">
<h4 id="_legacy_functions_in_drl"><a class="anchor" href="#_legacy_functions_in_drl"></a>Legacy functions in DRL</h4>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/function.png" alt="function">
</div>
<div class="title">Figure 23. Function</div>
</div>
<div class="paragraph">
<p>Functions in DRL files put semantic code in your rule source file instead of in Java classes. Functions are especially useful if an action (<code>then</code>) part of a rule is used repeatedly and only the parameters differ for each rule. Above the rules in the DRL file, you can declare the function or import a static method from a helper class as a function, and then use the function by name in an action (<code>then</code>) part of the rule.</p>
</div>
<div class="paragraph">
<p>The following examples illustrate a function that is either declared or an imported static method in a DRL file:</p>
</div>
<div class="listingblock">
<div class="title">Example function declaration with a rule (option 1)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">function String hello(String applicantName) {
    return "Hello " + applicantName + "!";
}

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example import a static method of a Java class (option 2)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.example.applicant;

public class MyFunctions {

    public static String hello(String applicantName) {
        return "Hello " + applicantName + "!";
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import static org.example.applicant.MyFunctions.hello;

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A function declared in a DRL file cannot be imported to a rule in a different package while a Java static method in a different package can be imported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A function body cannot access globals.</p>
</div>
<div class="paragraph">
<p>From the RHS of a rule, you can always pass a global as a function parameter when invoking the function, for exmaple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">global List names;

rule "Using a function with parameters"
  when
    // Empty
  then
    addName( names, "James" );
end

function void addName(List names, String applicantName) {
  names.add(applicantName);
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_legacy_rule_attributes"><a class="anchor" href="#_legacy_rule_attributes"></a>Legacy rule attributes</h4>
<div class="paragraph">
<p>The following attributes were used in earlier versions of the Drools rule engine to provide grouping of rules across a rule base. These attributes are superseded by DRL rule units and are only available for backward compatibility reasons. If you need to group your rules, use DRL rule units as a clearer and simpler grouping method.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Legacy rule attributes</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying an agenda group to which you want to assign the rule. Agenda groups allow you to partition the agenda to provide more execution control over groups of rules. Only rules in an agenda group that has acquired a focus are able to be activated.</p>
<p class="tableblock">Example: <code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying a rule flow group. In rule flow groups, rules can fire only when the group is activated by the associated rule flow.</p>
<p class="tableblock">Example: <code>ruleflow-group "GroupName"</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_legacy_drl_rule_condition_syntax"><a class="anchor" href="#_legacy_drl_rule_condition_syntax"></a>Legacy DRL rule condition syntax</h4>
<div class="paragraph">
<p>In Drools, the preferred syntax for DRL rule conditions is through OOPath expressions. For legacy use cases, you can write rules using traditional pattern matching. In this case, you must explicitly indicate the data source using the <code>from</code> clause, as shown in the following comparative examples:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>PersonRules</code> DRL file using OOPath notation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.acme
unit PersonRules;

import org.acme.Person;

rule isAdult
	when
		$person: /persons[ age &gt; 18 ]
	then
    modify($person) {
    	setAdult(true)
    };
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>PersonRules</code> DRL file using traditional notation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.acme
unit PersonRules;

import org.acme.Person;

rule isAdult
	when
		$person: Person(age &gt; 18) from person
	then
    modify($person) {
    	setAdult(true)
    };
end</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using OOPath, you can write nested paths. For example, <code>/persons[name == "Mark"]/addresses[city == "london"]/&#8230;&#8203;</code>. The first path <code>persons</code> is translated into a normal pattern matching, but all other paths after that first one are rendered with a <code>from</code> clause that has performance inefficiency. Hence, you have to be careful about using nested paths the same as too much use of <code>from</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_legacy_drl_rule_condition_elements"><a class="anchor" href="#_legacy_drl_rule_condition_elements"></a>Legacy DRL rule condition elements</h4>
<div class="paragraph">
<p>The following rule condition elements (keywords) are obsolete in Drools:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>from</code></dt>
<dd>
<p>(Obsolete with OOPath notation)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use this to specify a data source for a pattern. This enables the Drools rule engine to reason over data that is not in the working memory. The data source can be a sub-field on a bound variable or the result of a method call. The expression used to define the object source is any expression that follows regular MVEL syntax. Therefore, the <code>from</code> element enables you to easily use object property navigation, execute method calls, and access maps and collection elements.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/from.png" alt="from">
</div>
<div class="title">Figure 24. from</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from</code> and pattern binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Validate zipcode"
  when
    Person( $personAddress : address )
    Address( zipcode == "23920W" ) from $personAddress
  then
    // Zip code is okay.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from</code> and a graph notation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Validate zipcode"
  when
    $p : Person()
    $a : Address( zipcode == "23920W" ) from $p.address
  then
    // Zip code is okay.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from</code> to iterate over all objects</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Apply 10% discount to all items over US$ 100 in an order"
  when
    $order : Order()
    $item  : OrderItem( value &gt; 100 ) from $order.items
  then
    // Apply discount to `$item`.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For large collections of objects, instead of adding an object with a large graph that the Drools rule engine must iterate over frequently, add the collection directly to the KIE session and then join the collection in the condition, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">when
  $order : Order()
  OrderItem( value &gt; 100, order == $order )</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from</code> and <code>lock-on-active</code> rule attribute</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Assign people in North Carolina (NC) to sales region 1"
  ruleflow-group "test"
  lock-on-active true
  when
    $p : Person()
    $a : Address( state == "NC" ) from $p.address
  then
    modify ($p) {} // Assign the person to sales region 1.
end

rule "Apply a discount to people in the city of Raleigh"
  ruleflow-group "test"
  lock-on-active true
  when
    $p : Person()
    $a : Address( city == "Raleigh" ) from $p.address
  then
    modify ($p) {} // Apply discount to the person.
end</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using <code>from</code> with <code>lock-on-active</code> rule attribute can result in rules not being executed. You can address this issue in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoid using the <code>from</code> element when you can insert all facts into the working memory of the Drools rule engine or use nested object references in your constraint expressions.</p>
</li>
<li>
<p>Place the variable used in the <code>modify()</code> block as the last sentence in your rule condition.</p>
</li>
<li>
<p>Avoid using the <code>lock-on-active</code> rule attribute when you can explicitly manage how rules within the same ruleflow group place internalMatches on one another.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The pattern that contains a <code>from</code> clause cannot be followed by another pattern starting with a parenthesis. The reason for this restriction is that the DRL parser reads the <code>from</code> expression as <code>"from $l (String() or Number())"</code> and it cannot differentiate this expression from a function call. The simplest workaround to this is to wrap the <code>from</code> clause in parentheses, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rules with <code>from</code> used incorrectly and correctly</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">// Do not use `from` in this way:
rule R
  when
    $l : List()
    String() from $l
    (String() or Number())
  then
    // Actions
end

// Use `from` in this way instead:
rule R
  when
    $l : List()
    (String() from $l)
    (String() or Number())
  then
    // Actions
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>entry-point</code></dt>
<dd>
<p>(Superseded by rule unit data sources)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use this to define an entry point, or <em>event stream</em>, corresponding to a data source for the pattern. This element is typically used with the <code>from</code> condition element. You can declare an entry point for events so that the Drools rule engine uses data from only that entry point to evaluate the rules. You can declare an entry point either implicitly by referencing it in DRL rules or explicitly in your Java application.</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>from entry-point</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Authorize withdrawal"
  when
    WithdrawRequest( $ai : accountId, $am : amount ) from entry-point "ATM Stream"
    CheckingAccount( accountId == $ai, balance &gt; $am )
  then
    // Authorize withdrawal.
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>collect</code></dt>
<dd>
<p>(Obsolete with OOPath notation)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Use this to define a collection of objects that the rule can use as part of the condition. The rule obtains the collection either from a specified source or from the working memory of the Drools rule engine. The result pattern of the <code>collect</code> element can be any concrete class that implements the <code>java.util.Collection</code> interface and provides a default no-arg public constructor. You can use Java collections like <code>List</code>, <code>LinkedList</code>, and <code>HashSet</code>, or your own class. If variables are bound before the <code>collect</code> element in a condition, you can use the variables to constrain both your source and result patterns. However, any binding made inside the <code>collect</code> element is not available for use outside of it.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/collect.png" alt="collect">
</div>
<div class="title">Figure 25. Collect</div>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>collect</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import java.util.List

rule "Raise priority when system has more than three pending alarms"
  when
    $system : System()
    $alarms : List( size &gt;= 3 )
              from collect( Alarm( system == $system, status == 'pending' ) )
  then
    // Raise priority because `$system` has three or more `$alarms` pending.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule assesses all pending alarms in the working memory of the Drools rule engine for each given system and groups them in a <code>List</code>. If three or more alarms are found for a given system, the rule is executed.</p>
</div>
<div class="paragraph">
<p>You can also use the <code>collect</code> element with nested <code>from</code> elements, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule with <code>collect</code> and nested <code>from</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">import java.util.LinkedList;

rule "Send a message to all parents"
  when
    $town : Town( name == 'Paris' )
    $mothers : LinkedList()
               from collect( Person( children &gt; 0 )
                             from $town.getPeople()
                           )
  then
    // Send a message to all parents.
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>accumulate</code> alternate syntax for a single function with return type</dt>
<dd>
<p>The accumulate syntax evolved over time with the goal of becoming more compact and expressive.
Nevertheless, Drools still supports previous syntaxes for backward compatibility purposes.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>In case the rule is using a single accumulate function on a given accumulate, the author may add a pattern for the result object and use the "from" keyword to link it to the accumulate result.</p>
</div>
<div class="paragraph">
<p>Example: a rule to apply a 10% discount on orders over $100 could be written in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : /orders
    $total : Number( doubleValue &gt; 100 )
             from accumulate( OrderItem( order == $order, $value : value ),
                              sum( $value ) )
then
    // apply discount to $order
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the accumulate element is using only one function (sum), and so, the rules author opted to explicitly write a pattern for the result type of the accumulate function (Number) and write the constraints inside it.
There are no problems in using this syntax over the compact syntax presented before, except that is is a bit more verbose.
Also note that it is not allowed to use both the return type and the functions binding in the same accumulate statement.</p>
</div>
<div class="paragraph">
<p>Compile-time checks are performed in order to ensure the pattern used with the "<code>from</code>" keyword is  assignable from the result of the accumulate function used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With this syntax, the "<code>from</code>" binds to the single result returned by the accumulate function, and it does not iterate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above example, "<code>$total</code>" is bound to the result returned by the accumulate sum() function.</p>
</div>
<div class="paragraph">
<p>As another example however, if the result of the accumulate function is a collection, "<code>from</code>" still binds to the single result and it does not iterate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Person names"
when
  $x : Object() from accumulate(MyPerson( $val : name );
                                collectList( $val ) )
then
  // $x is a List
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bound "<code>$x : Object()</code>" is the List itself, returned by the collectList accumulate function used.</p>
</div>
<div class="paragraph">
<p>This is an important distinction to highlight, as the "<code>from</code>" keyword can also be used separately of accumulate, to iterate over the elements of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Iterate the numbers"
when
    $xs : List()
    $x : Integer() from $xs
then
  // $x matches and binds to each Integer in the collection
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this syntax is still supported for backward compatibility purposes, for this and other reasons we encourage rule authors to make use instead of the preferred <code>accumulate</code> syntax (described previously), to avoid any potential pitfalls.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>accumulate</code> with inline custom code</dt>
<dd>
<p>Another possible syntax for the <code>accumulate</code> is to define inline custom code, instead of using accumulate functions.</p>
<div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of accumulate with inline custom code is not a good practice for several reasons, including difficulties on maintaining and testing rules that use them, as well as the inability of reusing that code.
Implementing your own accumulate functions is very simple and straightforward, they are easy to unit test and to use.
This form of accumulate is supported for backward compatibility only.</p>
</div>
<div class="paragraph">
<p>Only limited support for inline accumulate is provided while using the executable model.
For example, you cannot use an external binding in the code while using the MVEL dialect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule R
dialect "mvel"
when
    String( $l : length )
    $sum : Integer() from accumulate (
                           Person( age &gt; 18, $age : age ),
                           init( int sum = 0 * $l; ),
                           action( sum += $age; ),
                           reverse( sum -= $age; ),
                           result( sum )
                     )</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The general syntax of the <code>accumulate</code> CE with inline custom code is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"><em>RESULT_PATTERN</em> from accumulate( <em>SOURCE_PATTERN</em>,
                                  init( <em>INIT_CODE</em> ),
                                  action( <em>ACTION_CODE</em> ),
                                  reverse( <em>REVERSE_CODE</em> ),
                                  result( <em>RESULT_EXPRESSION</em> ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The meaning of each of the elements is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>SOURCE_PATTERN</em>: the source pattern is a regular pattern that the Drools rule engine will try to match against each of the source objects.</p>
</li>
<li>
<p><em>INIT_CODE</em>: this is a semantic block of code in the selected dialect that will be executed once for each tuple, before iterating over the source objects.</p>
</li>
<li>
<p><em>ACTION_CODE</em>: this is a semantic block of code in the selected dialect that will be executed for each of the source objects.</p>
</li>
<li>
<p><em>REVERSE_CODE</em>: this is an optional semantic block of code in the selected dialect that if present will be executed for each source object that no longer matches the source pattern. The objective of this code block is to undo any calculation done in the <em>ACTION_CODE</em> block, so that the Drools rule engine can do decremental calculation when a source object is modified or deleted, hugely improving performance of these operations.</p>
</li>
<li>
<p><em>RESULT_EXPRESSION</em>: this is a semantic expression in the selected dialect that is executed after all source objects are iterated.</p>
</li>
<li>
<p><em>RESULT_PATTERN</em>: this is a regular pattern that the Drools rule engine tries to match against the object returned from the <em>RESULT_EXPRESSION</em>. If it matches, the <code>accumulate</code> conditional element evaluates to <em>true</em> and the Drools rule engine proceeds with the evaluation of the next CE in the rule. If it does not matches, the <code>accumulate</code> CE evaluates to <em>false</em> and the Drools rule engine stops evaluating CEs for that rule.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is easier to understand if we look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 )
             from accumulate( OrderItem( order == $order, $value : value ),
                              init( double total = 0; ),
                              action( total += $value; ),
                              reverse( total -= $value; ),
                              result( total ) )
then
    // apply discount to $order
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, for each <code>Order</code> in the Working Memory, the Drools rule engine will execute the <em>INIT_CODE</em> initializing the total variable to zero.
Then it will iterate over all <code>OrderItem</code> objects for that order, executing the <em>action</em> for each one (in the example, it will sum the value of all items into the total variable). After iterating over all <code>OrderItem</code> objects, it will return the value corresponding to the <em>result
          expression</em> (in the above example, the value of variable <code>total</code>). Finally, the Drools rule engine will try to match the result with the <code>Number</code> pattern, and if the double value is greater than 100, the rule will fire.</p>
</div>
<div class="paragraph">
<p>The example used Java as the semantic dialect, and as such, note that the usage of the semicolon as statement delimiter is mandatory in the init, action and reverse code blocks.
The result is an expression and, as such, it does not admit ';'. If the user uses any other dialect, he must comply to that dialect&#8217;s specific syntax.</p>
</div>
<div class="paragraph">
<p>As mentioned before, the <em>REVERSE_CODE</em> is optional, but it is strongly recommended that the user writes it in order to benefit from the <em>improved performance on update
          and delete</em>.</p>
</div>
<div class="paragraph">
<p>The <code>accumulate</code> CE can be used to execute any action on source objects.
The following example instantiates and populates a custom object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">rule "Accumulate using custom objects"
when
    $person   : Person( $likes : likes )
    $cheesery : Cheesery( totalAmount &gt; 100 )
                from accumulate( $cheese : Cheese( type == $likes ),
                                 init( Cheesery cheesery = new Cheesery(); ),
                                 action( cheesery.addCheese( $cheese ); ),
                                 reverse( cheesery.removeCheese( $cheese ); ),
                                 result( cheesery ) );
then
    // do something
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-drl-rules-central-create_drl-rules"><a class="anchor" href="#proc-drl-rules-central-create_drl-rules"></a>Creating DRL rules for your Drools project</h3>
<div class="paragraph _abstract">
<p>You can create and manage DRL rules for your Drools project in your integrated development environment (IDE). For Drools service, VSCode is the preferred IDE. In each DRL rule file, you define rule conditions, actions, and other components related to the rule, based on the data objects you create or import in the package.</p>
</div>
<div class="paragraph">
<p>In Drools, you typically define DRL rules in rule units. A DRL rule unit is a module for rules and a unit of execution. A rule unit collects a set of rules with the declaration of the type of facts that the rules act on. A rule unit also serves as a unique namespace for each group of rules. A single rule base can contain multiple rule units. You typically store all the rules for a unit in the same file as the unit declaration so that the unit is self-contained.</p>
</div>
<div class="paragraph">
<p>For this procedure, create the following example DRL type declarations and DRL rule unit to define DRL rules in a decision service for a loan application:</p>
</div>
<div class="listingblock">
<div class="title">Example DRL type declarations for a loan application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;

declare Bankruptcy
    name: String
    yearOfOccurrence: int
end

declare Applicant
    name: String
    age: int
end

declare LoanApplication
    applicant: String
    approved: boolean
    explanation: String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example DRL rule unit file for a loan application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;
unit MortgageRules;

import org.drools.ruleunits.api.RuleUnitData;
import org.drools.ruleunits.api.DataStore;

declare MortgageRules extends RuleUnitData
  bankruptcies: DataStore&lt;Bankruptcy&gt;
  applicants: DataStore&lt;Applicant&gt;
  loanApplications: DataStore&lt;LoanApplication&gt;
end

rule "Bankruptcy history"
	salience 10
	when
    $a : /loanApplications[ applicantName: applicant ]
    exists (/bankruptcies[ name == applicantName, yearOfOccurrence &gt; 1990 || amountOwed &gt; 100000 ])
	then
		$a.setApproved( false );
		$a.setExplanation( "has been bankrupt" );
		loanApplications.remove( $a );
end

rule "Underage"
	salience 15
	when
    /applicants[ applicantName : name, age &lt; 21 ]
    $application : /loanApplications[ applicant == applicantName ]
	then
		$application.setApproved( false );
		$application.setExplanation( "Underage" );
		loanApplications.remove( $a );
end</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have created a Drools project and have included any Java data objects required for your Drools service.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In your VSCode IDE, open your Drools project and create a <code>src/main/resources/org/mortgages</code> folder. This folder serves as the package for your DRL files in this example.</p>
</li>
<li>
<p>In your new <code>src/main/resources/org/mortgages</code> folder, add the following <code>ApplicationTypes.drl</code> file to define the fact types for the loan application service:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example DRL type declarations for a loan application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;

declare Bankruptcy
    name: String
    yearOfOccurrence: int
end

declare Applicant
    name: String
    age: int
end

declare LoanApplication
    applicant: String
    approved: boolean
    explanation: String
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This DRL file defines the fact types that you can declare in any rule units in the same package for the decision service. Declarations in DRL files define new fact types or metadata for fact types to be used by rules in a DRL files. If you declare these types directly in the DRL rule unit file, you cannot declare them in any other rule units.</p>
</div>
<div class="paragraph">
<p>This example defines the following fact types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Bankruptcy</code>: Provides data for bankruptcy status, if applicable</p>
</li>
<li>
<p><code>Applicant</code>: Provides data about the loan applicant</p>
</li>
<li>
<p><code>LoanApplication</code>: Provides data about loan approval status for a specified applicant, with an explanation if needed</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>In the same <code>src/main/resources/org/mortgages</code> folder of your Drools project, create the following <code>LoanApplication.drl</code> file to declare the DRL rule unit and data sources:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example DRL file with rule unit and data sources</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;
unit MortgageRules;

import org.drools.ruleunits.api.RuleUnitData;
import org.drools.ruleunits.api.DataStore;

declare MortgageRules extends RuleUnitData
  bankruptcies: DataStore&lt;Bankruptcy&gt;
  applicants: DataStore&lt;Applicant&gt;
  loanApplications: DataStore&lt;LoanApplication&gt;
end
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the rule unit is named <code>MortgageRules</code> and the previously defined fact types are declared as <code>DataStore</code> data sources.</p>
</div>
<div class="paragraph">
<p>Data sources are typed sources of data that rule units can subscribe to for updates. You interact with the rule unit through the data sources it exposes. A data source can be a <code>DataStream</code> source for append-only storage, a <code>DataStore</code> source for writable storage to add or remove data, or a <code>SingletonStore</code> source for writable storage to set and clear a single element.</p>
</div>
<div class="paragraph">
<p>This example uses the <code>DataStore</code> data source to enable application data to be added or removed as part of the decision service.</p>
</div>
</div>
</div>
</li>
<li>
<p>To complete the DRL rule unit file, add the following rules for <code>"Bankruptcy history"</code> and <code>"Underage"</code> logic:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example DRL rule unit file for a loan application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">package org.mortgages;
unit MortgageRules;

import org.drools.ruleunits.api.RuleUnitData;
import org.drools.ruleunits.api.DataStore;

declare MortgageRules extends RuleUnitData
  bankruptcies: DataStore&lt;Bankruptcy&gt;
  applicants: DataStore&lt;Applicant&gt;
  loanApplications: DataStore&lt;LoanApplication&gt;
end

rule "Bankruptcy history"
	salience 10
	when
    $a : /loanApplications[ applicantName: applicant ]
    exists (/bankruptcies[ name == applicantName, yearOfOccurrence &gt; 1990 || amountOwed &gt; 100000 ])
	then
		$a.setApproved( false );
		$a.setExplanation( "has been bankrupt" );
		loanApplications.remove( $a );
end

rule "Underage"
	salience 15
	when
    /applicants[ applicantName : name, age &lt; 21 ]
    $application : /loanApplications[ applicant == applicantName ]
	then
		$application.setApproved( false );
		$application.setExplanation( "Underage" );
		loanApplications.remove( $a );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example rules consist of the following rule components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rule</code>: Use this segment to define each rule in the DRL file. Rules consist of a rule name in the format <code>rule "rule name"</code>, followed by optional attributes that define rule behavior, such as <code>salience</code> or <code>no-loop</code>, followed by <code>when</code> and <code>then</code> definitions. Each rule must have a unique name within the rule package.</p>
<div class="paragraph">
<p>In this example, the <code>"Bankruptcy history"</code> rule has a defined salience of <code>10</code> and the <code>"Underage"</code> rule has a defined salience of <code>15</code>. These values ensure that the <code>"Bankruptcy history"</code> rule is executed first.</p>
</div>
</li>
<li>
<p><code>when</code> and <code>then</code>: Use the <code>when</code> portion to define the condition patterns and constraints in OOPath syntax and use the <code>then</code> portion to define the actions to be executed when the conditions are met.</p>
<div class="paragraph">
<p>In this example, the <code>"Bankruptcy history"</code> rule states that if an applicant has owed more than 100,000 USD of unresolved debt since 1990 (beginning 1991), then the applicant is considered to have been bankrupt and is not approved for a loan. The application is removed from memory.</p>
</div>
<div class="paragraph">
<p>If the applicant passes the bankruptcy check, then the <code>"Underage"</code> rule states that if the applicant is younger than 21 years old, then the applicant is not approved for the loan. The application is removed from memory.</p>
</div>
<div class="paragraph">
<p>If the applicant passes both checks, then the loan is approved.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>After you define all components of the data sources and rules, save all DRL files.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="performance-tuning-drl-ref_drl-rules"><a class="anchor" href="#performance-tuning-drl-ref_drl-rules"></a>Performance tuning considerations with DRL</h3>
<div class="paragraph">
<p>The following key concepts or suggested practices can help you optimize DRL rules and Drools rule engine performance. These concepts are summarized in this section as a convenience and are explained in more detail in the cross-referenced documentation, where applicable. This section will expand or change as needed with new releases of Drools.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Define the property and value of pattern constraints from left to right</dt>
<dd>
<p>In DRL pattern constraints, ensure that the fact property name is on the left side of the operator and that the value (constant or a variable) is on the right side. The property name must always be the key in the index and not the value. For example, write <code>Person( firstName == "John" )</code> instead of <code>Person( "John" == firstName )</code>. Defining the constraint property and value from right to left can hinder Drools rule engine performance.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For more information about DRL patterns and constraints, see <a href="#con-drl-rules-conditions_drl-rules">Rule conditions in DRL</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Use equality operators more than other operator types in pattern constraints when possible</dt>
<dd>
<p>Although the Drools rule engine supports many DRL operator types that you can use to define your business rule logic, the equality operator <code>==</code> is evaluated most efficiently by the Drools rule engine. Whenever practical, use this operator instead of other operator types. For example, the pattern <code>Person( firstName == "John" )</code> is evaluated more efficiently than <code>Person( firstName != "OtherName" )</code>. In some cases, using only equality operators might be impractical, so consider all of your business logic needs and options as you use DRL operators.</p>
</dd>
<dt class="hdlist1">List the most restrictive rule conditions first</dt>
<dd>
<p>For rules with multiple conditions, list the conditions from most to least restrictive so that the Drools rule engine can avoid assessing the entire set of conditions if the more restrictive conditions are not met.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, the following conditions are part of a travel-booking rule that applies a discount to travelers who book both a flight and a hotel together. In this scenario, customers rarely book hotels with flights to receive this discount, so the hotel condition is rarely met and the rule is rarely executed. Therefore, the first condition ordering is more efficient because it prevents the Drools rule engine from evaluating the flight condition frequently and unnecessarily when the hotel condition is not met.</p>
</div>
<div class="listingblock">
<div class="title">Preferred condition order: hotel and flight</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">when
  $h:hotel() // Rarely booked
  $f:flight()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Inefficient condition order: flight and hotel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">when
  $f:flight()
  $h:hotel() // Rarely booked</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about DRL patterns and constraints, see <a href="#con-drl-rules-conditions_drl-rules">Rule conditions in DRL</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Avoid iterating over large collections of objects with excessive <code>from</code> clauses</dt>
<dd>
<p>Avoid using the <code>from</code> condition element in DRL rules to iterate over large collections of objects, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example conditions with <code>from</code> clause</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">when
  $c: Company()
  $e : Employee ( salary &gt; 100000.00) from $c.employees</code></pre>
</div>
</div>
<div class="paragraph">
<p>In such cases, the Drools rule engine iterates over the large graph every time the rule condition is evaluated and impedes  rule evaluation.</p>
</div>
<div class="paragraph">
<p>Alternatively, instead of adding an object with a large graph that the Drools rule engine must iterate over frequently, add the collection directly to the KIE session and then join the collection in the condition, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example conditions without <code>from</code> clause</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">when
  $c: Company();
  Employee (salary &gt; 100000.00, company == $c)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the Drools rule engine iterates over the list only one time and can evaluate rules more efficiently.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>from</code> element or other DRL condition elements, see <a href="#con-drl-rules-conditions_drl-rules">Rule conditions in DRL</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Use Drools rule engine event listeners instead of <code>System.out.println</code> statements in rules for debug logging</dt>
<dd>
<p>You can use <code>System.out.println</code> statements in your rule actions for debug logging and console output, but doing this for many rules can impede rule evaluation. As a more efficient alternative, use the built-in Drools rule engine event listeners when possible. If these listeners do not meet your requirements, use a system logging utility supported by the Drools rule engine, such as Logback, Apache Commons Logging, or Apache Log4j.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For more information about supported Drools rule engine event listeners and logging utilities, see <a href="../rule-engine/index.html#engine-event-listeners-con_rule-engine" class="xref page">Drools rule engine event listeners and debug logging</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Use the <code>drools-metric</code> module to identify the obstruction in your rules</dt>
<dd>
<p>You can use the <code>drools-metric</code> module to identify slow rules especially when you process many rules. The <code>drools-metric</code> module can also assist in analyzing the Drools rule engine performance. Note that the <code>drools-metric</code> module is not for production environment use. However, you can perform the analysis in your test environment.</p>
<div class="paragraph">
<p>To analyze the Drools rule engine performance using <code>drools-metric</code>, first add <code>drools-metric</code> to your project dependencies:</p>
</div>
<div class="listingblock">
<div class="title">Example project dependency for <code>drools-metric</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-metric&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use <code>drools-metric</code> to enable trace logging, configure a logger for <code>org.drools.metric.util.MetricLogUtils</code> as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example logback.xml configuration file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;
  &lt;logger name="org.drools.metric.util.MetricLogUtils" level="trace"/&gt;
  ...
&lt;configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use <code>drools-metric</code> to expose the data using <a href="https://asciidoctor.org">Micrometer</a>. To expose the data, enable the Micrometer registry of your choice as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example project dependency for Micrometer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
  &lt;artifactId&gt;micrometer-registry-jmx&lt;/artifactId&gt; &lt;!-- Discover more registries at micrometer.io. --&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Java code for Micrometer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  Metrics.addRegitry(new JmxMeterRegistry(s -&gt; null, Clock.SYSTEM));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Regardless of whether you want to use logging or Micrometer, you need to enable <code>MetricLogUtils</code> by setting the system property <code>drools.metric.logger.enabled</code> to <code>true</code>. Optionally, you can change the microseconds threshold of metric reporting by setting the <code>drools.metric.logger.threshold</code> system property.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only node executions exceeding the threshold are reported. The default value is <code>500</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After configuring the <code>drools-metric</code> to use logging, rule execution produces logs as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example rule execution output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">TRACE [JoinNode(6) - [ClassObjectType class=com.sample.Order]], evalCount:1000, elapsedMicro:5962
TRACE [JoinNode(7) - [ClassObjectType class=com.sample.Order]], evalCount:100000, elapsedMicro:95553
TRACE [ AccumulateNode(8) ], evalCount:4999500, elapsedMicro:2172836
TRACE [EvalConditionNode(9)]: cond=com.sample.Rule_Collect_expensive_orders_combination930932360Eval1Invoker@ee2a6922], evalCount:49500, elapsedMicro:18787</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This example includes the following key parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>evalCount</code> is the number of constraint evaluations against inserted facts during the node execution. When <code>evalCount</code> is used with Micrometer, a counter with the data is called <code>org.drools.metric.evaluation.count</code>.</p>
</li>
<li>
<p><code>elapsedMicro</code> is the elapsed time of the node execution in microseconds. When <code>elapsedMicro</code> is used with Micrometer, look for a timer called <code>org.drools.metric.elapsed.time</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>If you find an outstanding <code>evalCount</code> or <code>elapsedMicro</code> log, correlate the node name with <code>ReteDumper.dumpAssociatedRulesRete()</code> output to identify the rule associated with the node.</p>
</div>
<div class="listingblock">
<div class="title">Example ReteDumper usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ReteDumper.dumpAssociatedRulesRete(kbase);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example ReteDumper output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ AccumulateNode(8) ] : [Collect expensive orders combination]
...</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_domain_specific_languages"><a class="anchor" href="#_domain_specific_languages"></a>Domain Specific Languages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>
Domain Specific Languages (or DSLs) are a way of creating a rule language that is dedicated to your problem domain.
A set of DSL definitions consists of transformations from DSL "sentences" to DRL constructs, which lets you use of all the underlying rule language and engine features.
Given a DSL, you write rules in DSL rule (or DSLR) files, which will be translated into DRL files.</p>
</div>
<div class="paragraph">
<p>DSL and DSLR files are plain text files, and you can use any text editor to create and modify them.
But there are also DSL and DSLR editors, both in the IDE as well as in the web based BRMS, and you can use those as well, although they may not provide you with the full DSL functionality.</p>
</div>
<div class="sect2">
<h3 id="_when_to_use_a_dsl"><a class="anchor" href="#_when_to_use_a_dsl"></a>When to Use a DSL</h3>
<div class="paragraph">
<p>DSLs can serve as a layer of separation between rule authoring (and rule authors) and the technical intricacies resulting from the modelling of domain object and the Drools rule engine&#8217;s native language and methods.
If your rules need to be read and validated by domain experts (such as business analysts, for instance) who are not programmers, you should consider  using a DSL; it hides implementation details and focuses on the rule logic proper.
DSL sentences can also act as "templates" for conditional elements and consequence actions that are used repeatedly in your rules, possibly with minor variations.
You may define DSL sentences as being mapped to these repeated phrases, with parameters providing a means for accommodating those variations.</p>
</div>
<div class="paragraph">
<p>DSLs have no impact on the Drools rule engine at runtime, they are just a compile time feature, requiring a special parser and transformer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dsl_basics"><a class="anchor" href="#_dsl_basics"></a>DSL Basics</h3>
<div class="paragraph">
<p>The Drools DSL mechanism allows you to customise conditional expressions and consequence actions.
A global substitution mechanism ("keyword") is also available.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Example  DSL mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[when]Something is {colour}=Something(colour=="{colour}")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, <code>[when]</code> indicates the scope of the expression, i.e., whether it is valid for the LHS or the RHS of a rule.
The part after the bracketed keyword is the expression that you use in the rule; typically a natural language expression, but it doesn&#8217;t have to be.
The part to the right of the equal sign ("=") is the mapping of the expression into the rule language.
The form of this string depends on its destination, RHS or  LHS.
If it is for the LHS, then it ought to be a term according to the regular LHS syntax; if it is for the RHS then it might be a Java statement.</p>
</div>
<div class="paragraph">
<p>Whenever the DSL parser matches a line from the rule file written in the DSL with an expression in the DSL definition, it performs three steps of string manipulation.
First, it extracts the string values appearing where the expression contains variable names in braces (here: <code>{colour}</code>). Then, the values obtained from these captures are then interpolated wherever that name, again enclosed in braces, occurs on the right hand side of the mapping.
Finally, the interpolated string replaces whatever was matched by the entire expression in the line of the DSL rule file.</p>
</div>
<div class="paragraph">
<p>Note that the expressions (i.e., the strings on the left hand side of the equal sign) are used as regular expressions in a pattern matching operation against a line of the DSL rule file, matching all or part of a line.
This means you can use (for instance) a '?' to indicate that the preceding character is optional.
One good reason to use this is to overcome variations in natural language phrases of your DSL.
But, given that these expressions are regular expression patterns, this also means that all "magic" characters of Java&#8217;s pattern syntax have to be escaped with a preceding backslash ('\').</p>
</div>
<div class="paragraph">
<p>It is important to note that the compiler transforms DSL rule files line by line.
In the previous example, all the text after "Something is " to the end of the line is captured as the replacement value for "{colour}", and this is used for interpolating the target string.
This may not be exactly what you want.
For instance, when you intend to merge different DSL expressions to generate a composite DRL pattern, you need to transform a DSLR line in several independent operations.
The best way to achieve this is to ensure that the captures are surrounded by characteristic text - words or  even single characters.
As a result, the matching operation done by the parser plucks out a substring from  somewhere within the line.
In the example below, quotes are used as  distinctive characters.
Note that the characters that surround the capture are not included during interpolation, just the contents between them.</p>
</div>
<div class="paragraph">
<p>As a rule of thumb, use quotes for textual data that a rule editor may want to enter.
You can also enclose the capture with words to ensure that the text is correctly matched.
Both is illustrated by the following example.
Note that a single line such as <code>Something is "green" and
    another solid thing</code> is now correctly expanded.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Example with quotes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[when]something is "{colour}"=Something(colour=="{colour}")
[when]another {state} thing=OtherThing(state=="{state})"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is a good idea to avoid punctuation (other than quotes or apostrophes) in your DSL expressions as much as possible.
The main reason is that punctuation is easy to forget for rule authors using your DSL.
Another reason is that parentheses, the period and the question mark are magic characters, requiring escaping in the DSL definition.</p>
</div>
<div class="paragraph">
<p>In a DSL mapping, the braces "{" and "}" should only be used to enclose a variable definition or reference, resulting in a capture.
If they should occur literally, either in the expression or within the replacement text on the right hand side, they must be escaped with a preceding backslash ("\"):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[then]do something= if (foo) \{ doSomething(); \}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If braces "{" and "}" should appear in the replacement string of a DSL definition, escape them with a backslash ('\').</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 3. Examples of DSL mapping entries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># This is a comment to be ignored.
[when]There is a person with name of "{name}"=Person(name=="{name}")
[when]Person is at least {age} years old and lives in "{location}"=
      Person(age &gt;= {age}, location=="{location}")
[then]Log "{message}"=System.out.println("{message}");
[when]And = and</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given the above DSL examples, the following examples show the expansion of various DSLR snippets:</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Examples of DSL expansions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">There is a person with name of "Kitty"
   ==&gt; Person(name="Kitty")
Person is at least 42 years old and lives in "Atlanta"
   ==&gt; Person(age &gt;= 42, location="Atlanta")
Log "boo"
   ==&gt; System.out.println("boo");
There is a person with name of "Bob" And Person is at least 30 years old and lives in "Utah"
   ==&gt; Person(name="Bob") and Person(age &gt;= 30, location="Utah")</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t forget that if you are capturing plain text from a DSL rule line and want to use it as a string literal in the expansion, you must provide the quotes on the right hand side of the mapping.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can chain DSL expressions together on one line, as long as it is clear to the parser where one ends and the next one begins and where the text representing a parameter ends.
(Otherwise you risk getting all the text until the end of the line as a parameter value.) The DSL expressions are tried, one after the other, according to their order in the DSL definition file.
After any match, all remaining DSL expressions are investigated, too.</p>
</div>
<div class="paragraph">
<p>The resulting DRL text may consist of more than one line.
Line ends are in the replacement text are written as <code>\n</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_constraints_to_facts"><a class="anchor" href="#_adding_constraints_to_facts"></a>Adding Constraints to Facts</h3>
<div class="paragraph">
<p>A common requirement when writing rule conditions is to be able to add an arbitrary combination of constraints to a pattern.
Given that a fact type may have many fields, having to provide an individual DSL statement for each combination would be plain folly.</p>
</div>
<div class="paragraph">
<p>The DSL facility allows you to add constraints to a pattern by a simple convention: if your DSL expression starts with a hyphen (minus character, "-") it is assumed to be a field constraint and, consequently, is is added to the last pattern line preceding it.</p>
</div>
<div class="paragraph">
<p>For an example, lets take look at class <code>Cheese</code>, with the following fields: type, price, age and country.
We can express some LHS condition in normal DRL like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Cheese(age &lt; 5, price == 20, type=="stilton", country=="ch")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The DSL definitions given below result in three DSL phrases which may be used to create any combination of constraint involving these fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[when]There is a Cheese with=Cheese()
[when]- age is less than {age}=age&lt;{age}
[when]- type is '{type}'=type=='{type}'
[when]- country equal to '{country}'=country=='{country}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then write rules with conditions like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">There is a Cheese with
        - age is less than 42
        - type is 'stilton'</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The parser will pick up a line beginning with "-" and add it as a constraint to  the preceding pattern, inserting a comma when it is required.
For the preceding example, the resulting DRL is:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Cheese(age&lt;42, type=='stilton')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Combining all numeric fields with all relational operators (according to the DSL expression "age is less than&#8230;&#8203;" in the preceding example) produces an unwieldy amount of DSL entries.
But you can define DSL phrases for the various operators and even a generic expression that handles any field constraint, as shown below.
(Notice that the expression definition contains a regular expression in addition to the variable name.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[when][]is less than or equal to=&lt;=
[when][]is less than=&lt;
[when][]is greater than or equal to=&gt;=
[when][]is greater than=&gt;
[when][]is equal to===
[when][]equals===
[when][]There is a Cheese with=Cheese()
[when][]- {field:\w*} {operator} {value:\d*}={field} {operator} {value}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given these DSL definitions, you can write rules with conditions such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">There is a Cheese with
   - age is less than 42
   - rating is greater than 50
   - type equals 'stilton'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this specific case, a phrase such as "is less than" is replaced by <code>&lt;</code>, and then the line matches the last DSL entry.
This removes the hyphen, but the final result is still added as a constraint to the preceding pattern.
After processing all of the lines, the resulting DRL text is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Cheese(age&lt;42, rating &gt; 50, type=='stilton')</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The order of the entries in the DSL is important if separate DSL expressions are intended to match the same line, one after the other.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_developing_a_dsl"><a class="anchor" href="#_developing_a_dsl"></a>Developing a DSL</h3>
<div class="paragraph">
<p>A good way to get started is to write representative samples of the rules your application requires, and to test them as you develop.
This will provide you with a stable framework of conditional elements and their constraints.
Rules, both in DRL and in DSLR, refer to entities according to the data model representing the application data that should be subject to the reasoning process defined in rules.
Notice that writing rules is generally easier if most of the data model&#8217;s types are facts.</p>
</div>
<div class="paragraph">
<p>Given an initial set of rules, it should be possible to identify recurring or similar code snippets and to mark variable parts as parameters.
This provides reliable leads as to what might be a handy DSL entry.
Also, make sure you have a full grasp of the jargon the  domain experts are using, and base your DSL phrases on this vocabulary.</p>
</div>
<div class="paragraph">
<p>You may postpone implementation decisions concerning conditions and actions during this first design phase by leaving certain conditional elements and actions in their DRL form by prefixing a line with a greater sign ("&gt;"). (This is also handy for inserting debugging statements.)</p>
</div>
<div class="paragraph">
<p>During the next development phase, you should find that the DSL configuration stabilizes pretty quickly.
New rules can be written by reusing the existing DSL definitions, or by adding a parameter to an existing condition or consequence entry.</p>
</div>
<div class="paragraph">
<p>Try to keep the number of DSL entries small.
Using parameters lets you apply the same DSL sentence for similar rule patterns or constraints.
But do not exaggerate: authors using the DSL should still be able to identify DSL phrases by some fixed text.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dsl_and_dslr_reference"><a class="anchor" href="#_dsl_and_dslr_reference"></a>DSL and DSLR Reference</h3>
<div class="paragraph">
<p>A DSL file is a text file in a line-oriented format.
Its entries are used for transforming a DSLR file into a file according to DRL syntax.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A line starting with "#" or "//" (with or without preceding white space) is treated as a comment. A comment line starting with "#/" is scanned for words requesting a debug option, see below.</p>
</li>
<li>
<p>Any line starting with an opening bracket ("[") is assumed to be the first line of a DSL entry definition.</p>
</li>
<li>
<p>Any other line is appended to the preceding DSL entry definition, with the line end replaced by a space.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A DSL entry consists of the following four parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A scope definition, written as one of the keywords "when" or "condition", "then" or "consequence", "*" and "keyword", enclosed in brackets ("[" and "]"). This indicates whether the DSL entry is valid for the condition or the consequence of a rule, or both. A scope indication of "keyword" means that the entry has global significance, i.e., it is recognized anywhere in a DSLR file.</p>
</li>
<li>
<p>A type definition, written as a Java class name, enclosed in brackets. This part is optional unless the next part begins with an opening bracket. An empty pair of brackets is valid, too.</p>
</li>
<li>
<p>A DSL expression consists of a (Java) regular expression, with any number of embedded <em>variable definitions,</em> terminated by an equal sign ("="). A variable definition is enclosed in braces ("{" and "}"). It consists of a variable name and two optional attachments, separated by colons (":"). If there is one attachment, it is a regular expression for matching text that is to be assigned to the variable; if there are two attachments, the first one is a hint for the GUI editor and the second one the regular expression.</p>
<div class="paragraph">
<p>Note that all characters that are "magic" in regular expressions must be escaped with a preceding backslash ("\") if they should occur literally within the expression.</p>
</div>
</li>
<li>
<p>The remaining part of the line after the delimiting equal sign is the replacement text for any DSLR text matching the regular expression. It may contain variable references, i.e., a variable name enclosed in braces. Optionally, the variable name may be followed by an exclamation mark ("!") and a transformation function, see below.</p>
<div class="paragraph">
<p>Note that braces ("{" and "}") must be escaped with a preceding backslash ("\") if they should occur literally within the replacement string.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debugging of DSL expansion can be turned on, selectively, by using a comment line starting with "#/" which may contain one or more words from the table presented below.
The resulting output is written to standard output.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Debug options for DSL expansion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Word</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the resulting DRL text, with line numbers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">steps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints each expansion step of condition and consequence
            lines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "keyword".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">when</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "when" or "*".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">then</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "then" or "*".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a usage statistic of all DSL entries.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Below are some sample DSL definitions, with comments describing the language features they illustrate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># Comment: DSL examples

#/ debug: display result and usage

# keyword definition: replaces "regula" by "rule"
[keyword][]regula=rule

# conditional element: "T" or "t", "a" or "an", convert matched word
[when][][Tt]here is an? {entity:\w+}=
        ${entity!lc}: {entity!ucfirst} ()

# consequence statement: convert matched word, literal braces
[then][]update {entity:\w+}=modify( ${entity!lc} )\{ \}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation of a DSLR file proceeds as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The text is read into memory.</p>
</li>
<li>
<p>Each of the "keyword" entries is applied to the entire text. First, the regular expression from the keyword definition is modified by replacing white space sequences with a pattern matching any number of white space characters, and by replacing variable definitions with a capture made from the regular expression provided with the definition, or with the default (".*?"). Then, the DSLR text is searched exhaustively for occurrences of strings matching the modified regular expression. Substrings of a matching string corresponding to variable captures are extracted and replace variable references in the corresponding replacement text, and this text replaces the matching string in the DSLR text.</p>
</li>
<li>
<p>Sections of the DSLR text between "when" and "then", and "then" and "end", respectively, are located and processed in a uniform manner, line by line, as described below.</p>
<div class="paragraph">
<p>For a line, each DSL entry pertaining to the line&#8217;s section is taken in turn, in the order it appears in the DSL file.
Its regular expression part is modified: white space is replaced by a pattern matching any number of white space characters; variable definitions with a regular expression are replaced by a capture with this regular expression, its default being ".*?". If the resulting regular expression matches all or part of the line, the matched part is replaced by the suitably modified replacement text.</p>
</div>
<div class="paragraph">
<p>Modification of the replacement text is done by replacing variable references with the text corresponding to the regular expression capture.
This text may be modified according to the string transformation function given in the variable reference; see below for details.</p>
</div>
<div class="paragraph">
<p>If there is a variable reference naming a variable that is not defined in the same entry, the expander substitutes a value bound to a variable of that name, provided it was defined in one of the preceding lines of the current rule.</p>
</div>
</li>
<li>
<p>If a DSLR line in a condition is written with a leading hyphen, the expanded result is inserted into the last line, which should contain a pattern CE, i.e., a type name followed by a pair of parentheses. if this pair is empty, the expanded line (which should contain a valid constraint) is simply inserted, otherwise a comma (",") is inserted beforehand.</p>
<div class="paragraph">
<p>If a DSLR line in a consequence is written with a leading hyphen, the expanded result is inserted into the last line, which should contain a "modify" statement, ending in a pair of braces ("{" and "}"). If this pair is empty, the expanded line (which should contain a valid method call) is simply inserted, otherwise a comma (",") is inserted beforehand.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is currently <em>not</em> possible to use a line with a leading hyphen to insert text into other conditional element forms (e.g., "accumulate") or it may only work for the first insertion (e.g., "eval").</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All string transformation functions are described in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. String transformation functions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts all letters to upper case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts all letters to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ucfirst</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts the first letter to upper case, and
            all other letters to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">num</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts all digits and "-" from the string. If the
            last two digits in the original string are preceded by "." or
            ",", a decimal period is inserted in the corresponding position.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>a</em>?<em>b</em>/<em>c</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compares the string with string <em>a</em>, and if they
            are equal, replaces it with <em>b</em>, otherwise with
            <em>c</em>. But <em>c</em> can be another triplet
            <em>a</em>, <em>b</em>, <em>c</em>, so
            that the entire structure is, in fact, a translation table.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following DSL examples show how to use string transformation functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># definitions for conditions
[when][]There is an? {entity}=${entity!lc}: {entity!ucfirst}()
[when][]- with an? {attr} greater than {amount}={attr} &lt;= {amount!num}
[when][]- with a {what} {attr}={attr} {what!positive?&gt;0/negative?%lt;0/zero?==0/ERROR}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A file containing a DSL definition has to be put under the resources folder or any of its subfolders like any other drools artifact.
It must have the extension <code>.dsl</code>, or alternatively be marked with type <code>ResourceType.DSL</code>.
when programmatically added to a <code>KieFileSystem</code>.
For a file using DSL definition, the extension <code>.dslr</code> should be used, while it can be added to a <code>KieFileSystem</code> with type <code>ResourceType.DSLR</code>.</p>
</div>
<div class="paragraph">
<p>For parsing and expanding a DSLR file the DSL configuration is read and supplied to the parser.
Thus, the parser can "recognize" the DSL expressions and transform them into native rule language expressions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="decision-tables-con_decision-tables"><a class="anchor" href="#decision-tables-con_decision-tables"></a>Spreadsheet decision tables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spreadsheet decision tables are XLS or XLSX spreadsheets that contain business rules defined in a tabular format. Each row in a decision table is a rule, and each column is a condition, an action, or another rule attribute. After you create and upload your spreadsheet decision tables, the rules you defined are compiled into Drools Rule Language (DRL) rules as with all other rule assets.</p>
</div>
<div class="paragraph">
<p>All data objects related to a spreadsheet decision table must be in the same project package as the spreadsheet decision table. Assets in the same package are imported by default. Existing assets in other packages can be imported with the decision table.</p>
</div>
<div class="sect2">
<h3 id="decision-tables-use-case-con"><a class="anchor" href="#decision-tables-use-case-con"></a>Decision table use case</h3>
<div class="paragraph">
<p>An online shopping site lists the shipping charges for ordered items. The site provides free shipping under the following conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The number of items ordered is 4 or more and the checkout total is $300 or more.</p>
</li>
<li>
<p>Standard shipping is selected (4 or 5 business days from the date of purchase).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are the shipping rates under these conditions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. For orders less than $300</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Number of items</th>
<th class="tableblock halign-left valign-top">Delivery day</th>
<th class="tableblock halign-left valign-top">Shipping charge in USD, N = Number of items</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 or fewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next day</p>
<p class="tableblock">2nd day</p>
<p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35</p>
<p class="tableblock">15</p>
<p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 or more</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next day</p>
<p class="tableblock">2nd day</p>
<p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N*7.50</p>
<p class="tableblock">N*3.50</p>
<p class="tableblock">N*2.50</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. For orders more than $300</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Number of items</th>
<th class="tableblock halign-left valign-top">Delivery day</th>
<th class="tableblock halign-left valign-top">Shipping charge in USD, N = Number of items</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 or fewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next day</p>
<p class="tableblock">2nd day</p>
<p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p>
<p class="tableblock">10</p>
<p class="tableblock">N*1.50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 or more</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Next day</p>
<p class="tableblock">2nd day</p>
<p class="tableblock">Standard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N*5</p>
<p class="tableblock">N*2</p>
<p class="tableblock">FREE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These conditions and rates are shown in the following example spreadsheet decision table:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/language-reference/decision-table-example-02.png" alt="Decision table example">
</div>
<div class="title">Figure 26. Decision table for shipping charges</div>
</div>
<div class="paragraph">
<p>In order for a decision table to be executed in Drools rule engine, the table must comply with certain structure and syntax requirements, within an XLS or XLSX spreadsheet, as shown in this example. For more information, see <a href="#decision-tables-defining-proc">Defining spreadsheet decision tables</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="decision-tables-defining-proc"><a class="anchor" href="#decision-tables-defining-proc"></a>Defining spreadsheet decision tables</h3>
<div class="paragraph">
<p>Spreadsheet decision tables (XLS or XLSX) require two key areas that define rule data: a <code>RuleSet</code> area and a <code>RuleTable</code> area. The <code>RuleSet</code> area of the spreadsheet defines elements that you want to apply globally to all rules in the same package (not only the spreadsheet), such as a rule set name or universal rule attributes. The <code>RuleTable</code> area defines the actual rules (rows) and the conditions, actions, and other rule attributes (columns) that constitute that rule table within the specified rule set. A spreadsheet of decision tables can contain multiple <code>RuleTable</code> areas, but only one <code>RuleSet</code> area.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Starting with Drools v8, file extension must end in either <code>.drl.xls</code>, <code>.drl.xlsx</code>, or <code>.drl.csv</code> as mentioned in the Release Notes.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should typically write only one spreadsheet of decision tables, containing all necessary <code>RuleTable</code> definitions, per rule package. You can write separate decision table spreadsheets for separate packages, but writing multiple spreadsheets in the same package can cause compilation errors from conflicting <code>RuleSet</code> or <code>RuleTable</code> attributes and is therefore not recommended.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refer to the following sample spreadsheet as you define your decision table:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/language-reference/decision-table-example-02.png" alt="Decision table example">
</div>
<div class="title">Figure 27. Sample spreadsheet decision table for shipping charges</div>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In a new XLS or XLSX spreadsheet, go to the second or third column and label a cell <code>RuleSet</code> (row 1 in example). Reserve the column or columns to the left for descriptive metadata (optional).</p>
</li>
<li>
<p>In the next cell to the right, enter a name for the <code>RuleSet</code>. This named rule set will contain all <code>RuleTable</code> rules defined in the rule package.</p>
</li>
<li>
<p>Under the <code>RuleSet</code> cell, define any rule attributes (one per cell) that you want to apply globally to all rule tables in the package. Specify attribute values in the cells to the right. For example, you can enter an <code>Import</code> label and in the cell to the right, specify relevant data objects from other packages that you want to import into the package for the decision table (in the format <code>package.name.object.name</code>). For supported cell labels and values, see <a href="#decision-tables-rule-set-entries-ref">RuleSet definitions</a>.</p>
</li>
<li>
<p>Below the <code>RuleSet</code> area and in the same column as the <code>RuleSet</code> cell, skip a row and label a new cell <code>RuleTable</code> (row 7 in example) and enter a table name in the same cell. The name is used as the initial part of the name for all rules derived from this rule table, with the row number appended for distinction. You can override this automatic naming by inserting a <code>NAME</code> attribute column.</p>
</li>
<li>
<p>Use the next four rows to define the following elements as needed (rows 8-11 in example):</p>
<div class="ulist">
<ul>
<li>
<p><strong>Rule attributes:</strong> Conditions, actions, or other attributes. For supported cell labels and values, see <a href="#decision-tables-rule-table-entries-ref">RuleTable definitions</a>.</p>
</li>
<li>
<p><strong>Object types:</strong> The data objects to which the rule attributes apply. If the same object type applies to multiple columns, merge the object cells into one cell across multiple columns (as shown in the sample decision table), instead of repeating the object type in multiple cells. When an object type is merged, all columns below the merged range will be combined into one set of constraints within a single pattern for matching a single fact at a time. When an object is repeated in separate columns, the separate columns can create different patterns, potentially matching different or identical facts.</p>
</li>
<li>
<p><strong>Constraints:</strong> Constraints on the object types.</p>
</li>
<li>
<p><strong>Column label:</strong> (Optional) Any descriptive label for the column, as a visual aid. Leave blank if unused.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As an alternative to populating both the object type and constraint cells, you can leave the object type cell or cells empty and enter the full expression in the corresponding constraint cell or cells. For example, instead of <code>Order</code> as the object type and <code>itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code>Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for other constraint cells.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>After you have defined all necessary rule attributes (columns), enter values for each column as needed, row by row, to generate rules (rows 12-17 in example). Cells with no data are ignored (such as when a condition or action does not apply).</p>
<div class="paragraph">
<p>If you need to add more rule tables to this decision table spreadsheet, skip a row after the last rule in the previous table, label another <code>RuleTable</code> cell in the same column as the previous <code>RuleTable</code> and  <code>RuleSet</code> cells, and create the new table following the same steps in this section (rows 19-29 in example).</p>
</div>
</li>
<li>
<p>Save your XLS or XLSX spreadsheet to finish.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, only the first worksheet in a spreadsheet workbook is processed as a decision table. Each <code>RuleSet</code> name combined with the <code>RuleTable</code> name must be unique across all decision table files in the same package.</p>
</div>
<div class="paragraph">
<p>If you want to process multiple worksheet decision tables, then create a <code>.properties</code> file with the same name as the spreadsheet workbook. The <code>.properties</code> file must contain a property sheet with comma-separated values (CSV) for the names of the worksheets, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sheets=Sheet1,Sheet2</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After Drools rule engine loads the decision table, the rules are internally rendered as DRL rules like the following example, from the sample spreadsheet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>//row 12
rule "Basic_12"
salience 10
  when
    $order : Order( itemsCount &gt; 0, itemsCount &lt;= 3, deliverInDays == 1 )
  then
    insert( new Charge( 35 ) );
end</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Enabling white space used in cell values</div>
<div class="paragraph">
<p>By default, any white space before or after values in decision table cells is removed before the decision table is processed by the Drools rule engine. To retain white space that you use intentionally before or after values in cells, set the <code>drools.trimCellsInDTable</code> system property to <code>false</code> in your Drools application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="decision-tables-rule-set-entries-ref"><a class="anchor" href="#decision-tables-rule-set-entries-ref"></a>RuleSet definitions</h4>
<div class="paragraph">
<p>Entries in the <code>RuleSet</code> area of a decision table define DRL constructs and rule attributes that you want to apply to all rules in a package (not only in the spreadsheet). Entries must be in a vertically stacked sequence of cell pairs, where the first cell contains a label and the cell to the right contains the value. A decision table spreadsheet can have only one <code>RuleSet</code> area.</p>
</div>
<div class="paragraph">
<p>The following table lists the supported labels and values for <code>RuleSet</code> definitions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Supported <code>RuleSet</code> definitions</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Label</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RuleSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The package name for the generated DRL file. Optional, the default is <code>rule_table</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must be the first entry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sequential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code>. If <code>true</code>, then salience is used to ensure that rules fire from the top down.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, no firing order is imposed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SequentialMaxPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer numeric value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. In sequential mode, this option is used to set the start value of the salience. If omitted, the default value is 65535.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SequentialMinPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer numeric value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. In sequential mode, this option is used to check if this minimum salience value is not violated. If omitted, the default value is 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EscapeQuotes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code>. If <code>true</code>, then quotation marks are escaped so that they appear literally in the DRL.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, quotation marks are escaped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NumericDisabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code>. If <code>true</code>, then a String representation is used for DRL instead of a double value
from a Numeric cell. It would also skip additional numeric processing for the double value. For example, date formatting based on Drools system property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, a double value is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IgnoreNumericFormat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code>. If <code>true</code>, then the format for numeric values is ignored, for example, percent and currency.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, DRL takes formatted values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Import</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of Java classes to import from another package.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Variables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declarations of DRL globals (a type followed by a variable name). Multiple global definitions must be separated by commas.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Functions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more function definitions, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Queries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more query definitions, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Declare</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more declarative types, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Unit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The rule units that the rules generated from this decision table belong to.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, the rules do not belong to any unit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Dialect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java</code> or <code>mvel</code>. The dialect used in the actions of the decision table.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, <code>java</code> is imposed.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In some cases, Microsoft Office, LibreOffice, and OpenOffice might encode a double quotation mark differently, causing a compilation error. For example, <code>&#8220;A&#8221;</code> will fail, but <code>"A"</code> will pass.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="decision-tables-rule-table-entries-ref"><a class="anchor" href="#decision-tables-rule-table-entries-ref"></a>RuleTable definitions</h4>
<div class="paragraph">
<p>Entries in the <code>RuleTable</code> area of a decision table define conditions, actions, and other rule attributes for the rules in that rule table. A spreadsheet of decision tables can contain multiple <code>RuleTable</code> areas.</p>
</div>
<div class="paragraph">
<p>The following table lists the supported labels (column headers) and values for <code>RuleTable</code> definitions. For column headers, you can use either the given labels or any custom labels that begin with the letters listed in the table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Supported <code>RuleTable</code> definitions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 35%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Label</th>
<th class="tableblock halign-left valign-top">Or custom label that begins with</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides the name for the rule generated from that row. The default is constructed from the text following the <code>RuleTable</code> tag and the row number.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At most one column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DESCRIPTION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Results in a comment within the generated rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At most one column.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONDITION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code snippet and interpolated values for constructing a constraint within a pattern in a condition.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one per rule table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ACTION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code snippet and interpolated values for constructing an action for the consequence of the rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one per rule table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>METADATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code snippet and interpolated values for constructing a metadata entry for the rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, any number of columns.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following sections provide more details about how condition, action, and metadata columns use cell data:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Conditions</dt>
<dd>
<p>For columns headed <code>CONDITION</code>, the cells in consecutive lines result in a conditional element:</p>
<div class="ulist">
<ul>
<li>
<p><strong>First cell:</strong> Text in the first cell below <code>CONDITION</code> develops into a pattern for the rule condition, and uses the snippet in the next line as a constraint. If the cell is merged with one or more neighboring cells, a single pattern with multiple constraints is formed. All constraints are combined into a parenthesized list and appended to the text in this cell.</p>
<div class="paragraph">
<p>If this cell is empty, the code snippet in the cell below it must result in a valid conditional element on its own. For example, instead of <code>Order</code> as the object type and <code>itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code>Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for any other constraint cells.</p>
</div>
<div class="paragraph">
<p>To include a pattern without constraints, you can write the pattern in front of the text of another pattern, with or without an empty pair of parentheses. You can also append a <code>from</code> clause to the pattern.</p>
</div>
<div class="paragraph">
<p>If the pattern ends with <code>eval</code>, code snippets produce boolean expressions for inclusion into a pair of parentheses after <code>eval</code>.</p>
</div>
<div class="paragraph">
<p>You can terminate the pattern with <code>@watch</code> annotation, which is used to customize the properties that the pattern is reactive on.</p>
</div>
</li>
<li>
<p><strong>Second cell:</strong> Text in the second cell below <code>CONDITION</code> is processed as a constraint on the object reference in the first cell. The code snippet in this cell is modified by interpolating values from cells farther down in the column. If you want to create a constraint consisting of a comparison using <code>==</code> with the value from the cells below, then the field selector alone is sufficient. If you use the field selector alone, but you want to use the condition as it is without appending any <code>==</code> comparison, you must terminate the condition with the symbol <code>?</code>. Any other comparison operator must be specified as the last item within the snippet, and the value from the cells below is appended. For all other constraint forms, you must mark the position for including the contents of a cell with the symbol <code>$param</code>. Multiple insertions are possible if you use the symbols <code>$1</code>, <code>$2</code>, and so on, and a comma-separated list of values in the cells below. However, do not separate <code>$1</code>, <code>$2</code>, and so on, by commas, or the table will fail to process.</p>
<div class="paragraph">
<p>To expand a text according to the pattern <code>forall($delimiter){$snippet}</code>, repeat the <code>$snippet</code> once for each of the values of the comma-separated list in each of the cells below, insert the value in place of the symbol <code>$</code>, and join these expansions by the given <code>$delimiter</code>. Note that the <code>forall</code> construct may be surrounded by other text.</p>
</div>
<div class="paragraph">
<p>If the first cell contains an object, the completed code snippet is added to the conditional element from that cell. A pair of parentheses is provided automatically, as well as a separating comma if multiple constraints are added to a pattern in a merged cell. If the first cell is empty, the code snippet in this cell must result in a valid conditional element on its own. For example, instead of <code>Order</code> as the object type and <code>itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code>Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for any other constraint cells.</p>
</div>
</li>
<li>
<p><strong>Third cell:</strong> Text in the third cell below <code>CONDITION</code> is a descriptive label that you define for the column, as a visual aid.</p>
</li>
<li>
<p><strong>Fourth cell:</strong> From the fourth row on, non-blank entries provide data for interpolation. A blank cell omits the condition or constraint for this rule.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Actions</dt>
<dd>
<p>For columns headed <code>ACTION</code>, the cells in consecutive lines result in an action statement:</p>
<div class="ulist">
<ul>
<li>
<p><strong>First cell:</strong> Text in the first cell below <code>ACTION</code> is optional. If present, the text is interpreted as an object reference.</p>
</li>
<li>
<p><strong>Second cell:</strong> Text in the second cell below <code>ACTION</code> is a code snippet that is modified by interpolating values from cells farther down in the column. For a singular insertion, mark the position for including the contents of a cell with the symbol <code>$param</code>. Multiple insertions are possible if you use the symbols <code>$1</code>, <code>$2</code>, and so on, and a comma-separated list of values in the cells below. However, do not separate <code>$1</code>, <code>$2</code>, and so on, by commas, or the table will fail to process.</p>
<div class="paragraph">
<p>A text without any marker symbols can execute a method call without interpolation. In this case, use any non-blank entry in a row below the cell to include the statement. The <code>forall</code> construct is supported.</p>
</div>
<div class="paragraph">
<p>If the first cell contains an object, then the cell text (followed by a period), the text in the second cell, and a terminating semicolon are strung together, resulting in a method call that is added as an action statement for the consequence. If the first cell is empty, the code snippet in this cell must result in a valid action element on its own.</p>
</div>
</li>
<li>
<p><strong>Third cell:</strong> Text in the third cell below <code>ACTION</code> is a descriptive label that you define for the column, as a visual aid.</p>
</li>
<li>
<p><strong>Fourth cell:</strong> From the fourth row on, non-blank entries provide data for interpolation. A blank cell omits the condition or constraint for this rule.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Metadata</dt>
<dd>
<p>For columns headed <code>METADATA</code>, the cells in consecutive lines result in a metadata annotation for the generated rules:</p>
<div class="ulist">
<ul>
<li>
<p><strong>First cell:</strong> Text in the first cell below <code>METADATA</code> is ignored.</p>
</li>
<li>
<p><strong>Second cell:</strong> Text in the second cell below <code>METADATA</code> is subject to interpolation, using values from the cells in the rule rows. The metadata marker character <code>@</code> is prefixed automatically, so you do not need to include that character in the text for this cell.</p>
</li>
<li>
<p><strong>Third cell:</strong> Text in the third cell below <code>METADATA</code> is a descriptive label that you define for the column, as a visual aid.</p>
</li>
<li>
<p><strong>Fourth cell:</strong> From the fourth row on, non-blank entries provide data for interpolation. A blank cell results in the omission of the metadata annotation for this rule.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="decision-tables-attributes-ref"><a class="anchor" href="#decision-tables-attributes-ref"></a>Additional rule attributes for RuleSet or RuleTable definitions</h4>
<div class="paragraph">
<p>The <code>RuleSet</code> and <code>RuleTable</code> areas also support labels and values for other rule attributes, such as <code>PRIORITY</code> or <code>NO-LOOP</code>. Rule attributes specified in a <code>RuleSet</code> area will affect all rule assets in the same package (not only in the spreadsheet). Rule attributes specified in a <code>RuleTable</code> area will affect only the rules in that rule table. You can use each rule attribute only once in a <code>RuleSet</code> area and once in a <code>RuleTable</code> area. If the same attribute is used in both <code>RuleSet</code> and <code>RuleTable</code> areas within the spreadsheet, then <code>RuleTable</code> takes priority and the attribute in the <code>RuleSet</code> area is overridden.</p>
</div>
<div class="paragraph">
<p>The following table lists the supported labels (column headers) and values for additional <code>RuleSet</code> or <code>RuleTable</code> definitions. For column headers, you can use either the given labels or any custom labels that begin with the letters listed in the table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Additional rule attributes for <code>RuleSet</code> or <code>RuleTable</code> definitions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Label</th>
<th class="tableblock halign-left valign-top">Or custom label that begins with</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PRIORITY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer defining the <code>salience</code> value of the rule. Rules with a higher salience value are given higher priority when ordered in the internalMatch queue. Overridden by the <code>Sequential</code> flag.</p>
<p class="tableblock">Example: <code>PRIORITY 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE-EFFECTIVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing a date and time definition. The rule can be activated only if the current date and time is after a <code>DATE-EFFECTIVE</code> attribute.</p>
<p class="tableblock">Example: <code>DATE-EFFECTIVE "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE-EXPIRES</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing a date and time definition. The rule cannot be activated if the current date and time is after the <code>DATE-EXPIRES</code> attribute.</p>
<p class="tableblock">Example: <code>DATE-EXPIRES "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NO-LOOP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. When this option is set to <code>true</code>, the rule cannot be reactivated (looped) if a consequence of the rule re-triggers a previously met condition.</p>
<p class="tableblock">Example: <code>NO-LOOP true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AGENDA-GROUP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying an agenda group to which you want to assign the rule. Agenda groups allow you to partition the agenda to provide more execution control over groups of rules. Only rules in an agenda group that has acquired a focus are able to be activated.</p>
<p class="tableblock">Example: <code>AGENDA-GROUP "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ACTIVATION-GROUP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying an internalMatch (or XOR) group to which you want to assign the rule. In internalMatch groups, only one rule can be activated. The first rule to fire will cancel all pending internalMatches of all rules in the internalMatch group.</p>
<p class="tableblock">Example: <code>ACTIVATION-GROUP "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DURATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A long integer value defining the duration of time in milliseconds after which the rule can be activated, if the rule conditions are still met.</p>
<p class="tableblock">Example: <code>DURATION 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying either <code>int</code> (interval) or <code>cron</code> timer definitions for scheduling the rule.</p>
<p class="tableblock">Example: <code>TIMER "*/5 * * * *"</code>  (every 5 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CALENDAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Quartz calendar definition for scheduling the rule.</p>
<p class="tableblock">Example: <code>CALENDAR "* * 0-7,18-23 ? * *"</code>  (exclude non-business hours)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTO-FOCUS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value, applicable only to rules within agenda groups. When this option is set to <code>true</code>, the next time the rule is activated, a focus is automatically given to the agenda group to which the rule is assigned.</p>
<p class="tableblock">Example: <code>AUTO-FOCUS true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOCK-ON-ACTIVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value, applicable only to rules within rule flow groups or agenda groups. When this option is set to <code>true</code>, the next time the ruleflow group for the rule becomes active or the agenda group for the rule receives a focus, the rule cannot be activated again until the ruleflow group is no longer active or the agenda group loses the focus. This is a stronger version of the <code>no-loop</code> attribute, because the internalMatch of a matching rule is discarded regardless of the origin of the update (not only by the rule itself). This attribute is ideal for calculation rules where you have a number of rules that modify a fact and you do not want any rule re-matching and firing again.</p>
<p class="tableblock">Example: <code>LOCK-ON-ACTIVE true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RULEFLOW-GROUP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying a rule flow group. In rule flow groups, rules can fire only when the group is activated by the associated rule flow.</p>
<p class="tableblock">Example: <code>RULEFLOW-GROUP "GroupName"</code></p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="../_images/language-reference/decision-table-example-03.png" alt="Example decision table with definitions used">
</div>
<div class="title">Figure 28. Sample decision table spreadsheet with attribute columns</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples_of_decision_table_data_interpolation"><a class="anchor" href="#_examples_of_decision_table_data_interpolation"></a>Examples of decision table data interpolation</h4>
<div class="paragraph">
<p>The various interpolations of data in decision tables are illustrated in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Interpolating cell data</div>
<div class="content">
<div class="paragraph">
<p>If the template is <code>Foo(bar == $param)</code> and the cell is <code>42</code>, then the result is <code>Foo(bar == 42)</code>.</p>
</div>
<div class="paragraph">
<p>If the template is <code>Foo(bar &lt; $1, baz == $2)</code> and the cell contains <code>42,43</code>, the result will be <code>Foo(bar &lt; 42, baz ==43)</code>.</p>
</div>
<div class="paragraph">
<p>The template <code>forall(&amp;&amp;){bar != $}</code> with a cell containing <code>42,43</code> results in <code>bar != 42 &amp;&amp; bar != 43</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The next example demonstrates the joint effect of a cell defining the pattern type and the code snippet below it.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">RuleTable Cheese fans</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2" style="background-color: #fcedcd;"><p class="tableblock">Person</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">age</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">type</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Persons age</p></td>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Cheese type</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">stilton</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">cheddar</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This spreadsheet section shows how the <code>Person</code> type declaration spans 2 columns, and thus both constraints will appear as <code>Person(age == &#8230;&#8203;, type == &#8230;&#8203;)</code>.
Since only the field names are present in the snippet, they imply an equality test.</p>
</div>
<div class="paragraph">
<p>In the following example the marker symbol <code>$param</code> is used.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">Person</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">age == $param</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Persons age
</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The result of this column is the pattern <code>Person(age == 42))</code>.
You may have noticed that the marker and the operator "==" are redundant.</p>
</div>
<div class="paragraph">
<p>The next example illustrates that a trailing insertion marker can be omitted.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">Person</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">age &lt;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Persons age
</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here, appending the value from the cell is implied, resulting in <code>Person(age &lt; 42)).</code></p>
</div>
<div class="paragraph">
<p>You can provide the definition of a binding variable, as in the example below.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">CONDITION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">c : Cheese</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">type</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Cheese type
</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">stilton</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here, the result is <code>c: Cheese(type == "stilton").</code> Note that the quotes are provided automatically.
Actually, anything can be placed in the object type row.
Apart from the definition of a binding variable, it could also be an additional pattern that is to be inserted literally.</p>
</div>
<div class="paragraph">
<p>A simple construction of an action statement with the insertion of a single value is shown below.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 40%;">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">ACTION</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #fcedcd;"><p class="tableblock">list.add("$param");</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color: #c0edf7;"><p class="tableblock">Log
</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Old man stilton</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The cell below the ACTION header is left blank.
Using this style, anything can be placed in the consequence, not just a single method call.
(The same technique is applicable within a CONDITION column as well.)</p>
</div>
<div class="paragraph">
<p>Below is a comprehensive example, showing the use of various column headers.
It is not an error to have no value below a column header (as in the NO-LOOP column): here, the attribute will not be applied in any of the rules.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/Key.png" alt="Key">
</div>
<div class="title">Figure 29. Example usage of keywords for imports, headers, etc.</div>
</div>
<div class="paragraph">
<p>And, finally, here is an example of Import and Functions.</p>
</div>
<table class="tableblock frame-all grid-all center" style="width: 80%;">
<caption class="title">Table 11. Example of functions for computing price and discount claim.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #000000;"><p class="tableblock"><span class="white">RuleSet</span></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #000000;"><p class="tableblock"><span class="white">Cheese Price</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #fcedcd;"><p class="tableblock">Import</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #fcedcd;"><p class="tableblock">com.sample.Cheese, com.sample.Person</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #fcedcd;"><p class="tableblock">Functions</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #fcedcd;"><div class="content"><div class="listingblock">
<div class="content">
<pre>function int computePrice(Cheese cheese) {
    if (cheese.getType() == "cheddar") {
        return 10;
    } else if (cheese.getType() == "stilton") {
        return 15;
    } else {
        return 20;
    }
}

function boolean hasDiscount(Person person) {
    if (person.getAge() &gt; 60) {
        return true;
    } else {
        return false;
    }
}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Multiple package names within the same cell must be separated by a comma.
Also, the pairs of type and variable names must be comma-separated.
Functions, however, must be written as they appear in a DRL file.
This should appear in the same column as the "RuleSet" keyword; it could be above, between, or below all the rule rows.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It may be more convenient to use Import, Variables, Functions and Queries repeatedly rather than packing several definitions into a single cell.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_and_integrating_spreadsheet_decision_tables"><a class="anchor" href="#_creating_and_integrating_spreadsheet_decision_tables"></a>Creating and integrating spreadsheet decision tables</h3>
<div class="paragraph">
<p>The API to use spreadsheet decision tables is in the <code>drools-decisiontables</code> module.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When including <code>drools-decisiontables</code> in your project, you might encounter the following error: <code>ERROR StatusLogger Log4j2 could not find a logging implementation</code>; this happens because the underlying library to process spreadsheet files Apache POI uses the Log4j API (<a href="https://poi.apache.org/components/logging.html#POI+5.1.0+and+above:~:text=Apache%20POI%20only%20depends%20on%20log4j%2Dapi">reference</a>). To avoid that error, you must include either the <a href="https://logging.apache.org/log4j/log4j-2.2/log4j-to-slf4j/index.html">SLF4J adapter</a> or the <a href="https://logging.apache.org/log4j/log4j-2.2/log4j-slf4j-impl/index.html">Log4j 2 SLF4J Binding</a>, depending on whether your project is using Log4j as a logging backend.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is only one class to look at: <code>SpreadsheetCompiler</code>.
This class will take spreadsheets in various formats, and generate rules in DRL (which you can then use in the normal way). The <code>SpreadsheetCompiler</code> can just be used to generate partial rule files if it is wished and assemble them into a complete rule package after the fact (this allows the separation of technical and non-technical aspects of the rules if needed).</p>
</div>
</div>
<div class="sect2">
<h3 id="_decision_table_workflow_and_collaboration"><a class="anchor" href="#_decision_table_workflow_and_collaboration"></a>Decision table workflow and collaboration</h3>
<div class="paragraph">
<p>Spreadsheets are well-established business tools (in use for over 25 years). Decision tables lend themselves to close collaboration between IT and domain experts while making the business rules clear to business analysts, it is an ideal separation of concerns.</p>
</div>
<div class="paragraph">
<p>Typically, the whole process of authoring rules (coming up with a new decision table) would be something like:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A business analyst takes a template decision table (from a repository, or IT)</p>
</li>
<li>
<p>Decision table business language descriptions are entered in the table(s)</p>
</li>
<li>
<p>Decision table rules (rows) are entered (roughly)</p>
</li>
<li>
<p>A decision table is handed to a technical resource, who maps the business language (descriptions) to scripts (this may involve software development of course if it is a new application or data model)</p>
</li>
<li>
<p>The technical person hands back and reviews the modifications with the business analyst.</p>
</li>
<li>
<p>The business analyst can continue editing the rule rows as needed (moving columns around is also fine etc).</p>
</li>
<li>
<p>In parallel, the technical person can develop test cases for the rules (liaising with business analysts) as these test cases can be used to verify rules and rule changes once the system is running.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_using_spreadsheet_features"><a class="anchor" href="#_using_spreadsheet_features"></a>Using spreadsheet features</h3>
<div class="paragraph">
<p>Features of applications like Excel can be used to provide assistance in entering data into spreadsheets, such as validating fields.
Lists that are stored in other worksheets can be used to provide valid lists of values for cells, like in the following diagram.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/language-reference/lists.png" alt="lists">
</div>
</div>
<div class="paragraph">
<p>Some applications provide a limited ability to keep a history of changes, but it is recommended to use an alternative means of revision control.
When changes are being made to rules over time, older versions are archived (many open source solutions exist for this, such as Subversion or Git).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>DRT (Drools Rule Template) is deprecated. Please consider this decision table capability or third party templating features if needed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<!--Licensed to the Apache Software Foundation (ASF) under one-->
<!--or more contributor license agreements.  See the NOTICE file-->
<!--distributed with this work for additional information-->
<!--regarding copyright ownership.  The ASF licenses this file-->
<!--to you under the Apache License, Version 2.0 (the-->
<!--"License"); you may not use this file except in compliance-->
<!--with the License.  You may obtain a copy of the License at-->

<!--http://www.apache.org/licenses/LICENSE-2.0-->

<!--Unless required by applicable law or agreed to in writing,-->
<!--software distributed under the License is distributed on an-->
<!--"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY-->
<!--KIND, either express or implied.  See the License for the-->
<!--specific language governing permissions and limitations-->
<!--under the License.-->

<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
